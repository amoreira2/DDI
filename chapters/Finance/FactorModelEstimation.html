
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8. Estimation: From historical data to the future dynamics of returns &#8212; Data Driven Investing with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/FactorModelEstimation';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/FactorModelEstimation.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Timing" href="Timing.html" />
    <link rel="prev" title="7. Capital Allocation" href="CapitalAllocationI.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Data Driven Investing with Python - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Data Driven Investing with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.12. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">9.2. üìà Volatility Timing: Boosting Sharpe Ratios! üöÄ</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">10.18. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.19. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">14.7. üìä Interpreting Factor Models</a></li>



</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="RiskManagement.html">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLMs.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/FactorModelEstimation.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/FactorModelEstimation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/FactorModelEstimation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Estimation: From historical data to the future dynamics of returns</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libraries-and-auxiliary-functions">8.1. Libraries and Auxiliary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-model-recap">8.2. Factor Model recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-estimation-problem-that-we-need-to-solve">8.3. What is the estimation problem that we need to solve?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#betas-factor-loadings">8.4. Betas (Factor Loadings)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#our-data">8.4.1. Our Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-estimate-betas">8.4.2. How do we estimate betas?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is-this-too-good-to-be-true">8.4.3. Is this too Good to be true?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#betas-over-time">8.4.4. Betas over time</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-function-definition">8.4.4.1. üêç Note: function definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-groupby">8.4.4.2. üêç Note: Groupby</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty">8.4.5. Uncertainty</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-anonymous-function-lambda">8.4.5.1. üêç Note : Anonymous Function (lambda)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals">8.4.5.2. Confidence Intervals</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-question-these-standard-errors-confidence-intervals-answer">8.4.5.3. What question these standard errors/confidence intervals answer?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#it-is-a-forecasting-problem">8.4.5.4. It is a Forecasting Problem!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-decay-models">8.4.6. Exponential decay models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variances">8.5. Variances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variances-over-time">8.5.1. Variances Over time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-rolling-method">8.5.2. üêç Note : Rolling method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nobel-insight">8.5.3. Nobel insight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#realized-variance">8.5.4. Realized Variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-realized-variance">8.5.5. Forecasting Realized Variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-with-market-views">8.5.6. Forecasting with market views</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#idiosyncratic-volatility">8.5.7. Idiosyncratic  Volatility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-g3">8.5.8. ‚ö° ‚è∞ Question: G3 ‚ö°</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-section-vs-time-series">8.6. Cross-Section vs Time-series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-returns">8.7. Expected returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-risk-premia">8.7.1. Factor Risk-Premia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-sizes-and-learning-about-means">8.7.2. Sample sizes and learning about means</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detecting-time-variation-in-means">8.7.3. Detecting time-variation in means</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-is-all-you-need">8.8. Alpha is all you need</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-stacked-data-sets">8.8.1. üêç Note : Stacked data sets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-you-find-alpha">8.8.2. How do you find alpha?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-not-estimation-then-what">8.8.3. If not estimation then what?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-quantification-procedure">8.8.4. Alpha Quantification Procedure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors">8.8.5. Real Alpha is unique and cannot be driven by broad macro factors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">8.9. üìù Key Takeaways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-material-the-normal-distribution">8.10. Extra Material: The Normal distribution</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="estimation-from-historical-data-to-the-future-dynamics-of-returns">
<h1><span class="section-number">8. </span>Estimation: From historical data to the future dynamics of returns<a class="headerlink" href="#estimation-from-historical-data-to-the-future-dynamics-of-returns" title="Link to this heading">#</a></h1>
<blockquote>
<div><p>‚ÄúIt is a capital mistake to theorize before one has data‚Äù</p>
</div></blockquote>
<hr class="docutils" />
<p><strong>üéØ Learning Objectives</strong></p>
<ol class="arabic simple">
<li><p>Our objective here is to understand when and how past data is informative about the future behavior of returns</p></li>
<li><p>Factor model and it‚Äôs parameters are an useful lens because it allow us to separate the pieces that the data is useful from the pieces that the data is not</p></li>
<li><p>We will look at <span class="math notranslate nohighlight">\(\beta\)</span>‚Äôs, Variances, factor premia, and alphas</p></li>
<li><p>This class might feel as ‚Äústats‚Äù class, but it is at the core of quant investing</p></li>
<li><p>What information is in the data?</p></li>
</ol>
<hr class="docutils" />
<section id="libraries-and-auxiliary-functions">
<h2><span class="section-number">8.1. </span>Libraries and Auxiliary Functions<a class="headerlink" href="#libraries-and-auxiliary-functions" title="Link to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Every time we start a new colab we need to install and import WRDS (if we are goign to use it)</span>
<span class="c1">## The way it works is that you click install and then an error is returned and you click &quot;RESTART&quot;</span>
<span class="c1">## Once you do that you can import it (i.e. run the next cell)</span>
<span class="c1">#%pip install wrds</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## for this to work you first need to install it</span>
<span class="c1">#import wrds</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">DataReader</span>

<span class="c1"># define functions</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="c1"># Retrieve PERMNOs for the specified tickers</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s1">&#39;crsp&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;stocknames&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;namedt&#39;</span><span class="p">,</span> <span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>
    <span class="c1"># Extract unique PERMNOs</span>
    <span class="n">permno_list</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">permno_list</span><span class="p">)</span>

    <span class="c1"># Query daily stock file for the specified PERMNOs</span>

    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT permno, date, ret, retx, prc</span>
<span class="s2">        FROM crsp.dsf</span>
<span class="s2">        WHERE permno IN (</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">permno_list</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        ORDER BY date,permno</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">date_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">permnos</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1"># Pivot data to have dates as index and tickers as columns</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span>
    <span class="n">daily_returns</span><span class="o">=</span><span class="n">daily_returns</span><span class="p">[</span><span class="n">tickers</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">daily_returns</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_factors</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="s1">&#39;CAPM&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;CAPM&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;FF3&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_Factors_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">factors</span><span class="o">==</span><span class="s1">&#39;FF5&#39;</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Momentum_Factor_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1921-01-01&quot;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_factor</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="factor-model-recap">
<h2><span class="section-number">8.2. </span>Factor Model recap<a class="headerlink" href="#factor-model-recap" title="Link to this heading">#</a></h2>
<p>We have been working with a single asset, since factor model</p>
<p>Realized returns:</p>
<div class="math notranslate nohighlight">
\[r=rf+\alpha + b(f-rf)+\epsilon\]</div>
<p>Expected  returns</p>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha + b*E[f]\]</div>
<p>Expected excess returns</p>
<div class="math notranslate nohighlight">
\[E[r^{e}]=\alpha + b*E[f]\]</div>
<p>Variance:</p>
<div class="math notranslate nohighlight">
\[Var(r)=b^2Var(f-rf)+Var(\epsilon)\]</div>
<p>To know the expected returns of your investment you need</p>
<ol class="arabic simple">
<li><p>The risk-free rate</p></li>
<li><p>The beta</p></li>
<li><p>The factor risk-premia</p></li>
<li><p>The asset specific alpha</p></li>
</ol>
<p>To know the risk/variance of your investment you need</p>
<ol class="arabic simple" start="5">
<li><p>The factor variance</p></li>
<li><p>The asset specific variance</p></li>
</ol>
</section>
<section id="what-is-the-estimation-problem-that-we-need-to-solve">
<h2><span class="section-number">8.3. </span>What is the estimation problem that we need to solve?<a class="headerlink" href="#what-is-the-estimation-problem-that-we-need-to-solve" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Do you want to know how this stock behaved in the past? ‚ùå</p></li>
<li><p>Do we want to know how it behaved in the recent past?‚ùå</p></li>
<li><p>So why should we care about historical data?</p></li>
</ul>
<p><strong>It is about the future, Watson ‚úÖ</strong></p>
<ul class="simple">
<li><p>We need to estimate these moments for our investment period, say next minute, day, month or year</p></li>
<li><p>Some of those we observe directly in financial markets like the risk-free rate‚Äìfinancial markets tell you exactly how much your will earn going forward‚Äìjust look at government bonds</p></li>
<li><p>Others we need to use  data to form our views</p></li>
<li><p>None of this specific to factor models. But factor models are helpful in stripping the estimation problem in different pieces</p></li>
<li><p>We discuss below one-by-one</p></li>
</ul>
</section>
<section id="betas-factor-loadings">
<h2><span class="section-number">8.4. </span>Betas (Factor Loadings)<a class="headerlink" href="#betas-factor-loadings" title="Link to this heading">#</a></h2>
<p>Factors models are all about the time-series co-movement between assets and some common factors. For now we are focused on single factors models, but we will soon be thinking about multiple-factors at the same time.</p>
<p>We will focus on factors that can be expressed in excess returns, like the returns on the market portfolio. Practicioners often use characteristics as direct proxys for betas‚Äìwe will see that later. This is useful when we have many factors‚Ä¶but does not work to the most important factor of all‚Äìthe market factor.</p>
<p>Fundamentally any risk-factor can be represented in terms of a return of a specific portfolio.</p>
<p>The beta that we are interested is the forward-looking degree of co-movement between the asset and the factor</p>
<p>Specifically it is</p>
<div class="math notranslate nohighlight">
\[\beta_t=\frac{Cov_t(r_{t+1}^{e},f_{t+1})}{var_t(f_{t+1})}\]</div>
<ul class="simple">
<li><p>What this notation means?</p></li>
<li><p>It is asking to what extent the asset returns are above it‚Äôs expected values when the factor is above it‚Äôs expected value</p></li>
<li><p>It normalizes everything by the variance of the factor</p></li>
<li><p>So a beta of 1 means that the asset is EXPECTED to move 1 for 1 with the factor</p></li>
<li><p>But of course it can have some additional indio risk on top</p></li>
<li><p>The subscripts in the covariance and variance means that it is these moments from the perspective of someone that has all the information up to  date <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>That is, you don‚Äôt know the particular realization of the variables‚Äìyou do not have a crystal ball</p></li>
</ul>
<section id="our-data">
<h3><span class="section-number">8.4.1. </span>Our Data<a class="headerlink" href="#our-data" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Pick your favorite stock, construct excess returns</p></li>
<li><p>Use returns on the market as a factor</p></li>
<li></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## uncomment to use WRDS to get data</span>
<span class="c1">######################################</span>
<span class="c1"># conn = wrds.Connection()</span>
<span class="c1"># tickers=[&#39;GE&#39;]</span>
<span class="c1"># df = get_daily_wrds(conn,tickers)</span>
<span class="c1"># df.to_csv(&#39;../../assets/data/FactorModelsEstimation_data1.csv&#39;)</span>
<span class="c1">#######################################</span>
<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/amoreira2/UG54/refs/heads/main/assets/data/FactorModelsEstimation_data1.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>



<span class="n">df_factor</span> <span class="o">=</span> <span class="n">get_factors</span><span class="p">()</span>
<span class="n">df</span><span class="p">,</span> <span class="n">df_factor</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df_factor</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tickers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GE&#39;</span><span class="p">]</span>
<span class="n">df_re</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">tickers</span><span class="p">]</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># why not the simpler code below? Which one is more robust?</span>
<span class="c1">#df_re=df[tickers]-df_factor[&#39;RF&#39;]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipython-input-1066857734.py:38: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  fama_french = DataReader.DataReader(&quot;F-F_Research_Data_Factors_daily&quot;, &quot;famafrench&quot;,start=&quot;1921-01-01&quot;)
</pre></div>
</div>
<div class="output text_html">
  <div id="df-fb6fd70b-c040-4c6f-925a-0b753691c23b" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1926-07-01</th>
      <td>-0.000090</td>
    </tr>
    <tr>
      <th>1926-07-02</th>
      <td>-0.000090</td>
    </tr>
    <tr>
      <th>1926-07-06</th>
      <td>0.007220</td>
    </tr>
    <tr>
      <th>1926-07-07</th>
      <td>-0.000090</td>
    </tr>
    <tr>
      <th>1926-07-08</th>
      <td>0.004264</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-fb6fd70b-c040-4c6f-925a-0b753691c23b')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-fb6fd70b-c040-4c6f-925a-0b753691c23b button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-fb6fd70b-c040-4c6f-925a-0b753691c23b');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-8f5b9de8-eb2a-4541-b1da-c5dee301706e">
      <button class="colab-df-quickchart" onclick="quickchart('df-8f5b9de8-eb2a-4541-b1da-c5dee301706e')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-8f5b9de8-eb2a-4541-b1da-c5dee301706e button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div><div class="output text_html">
  <div id="df-a0caac43-5dc3-4e8e-b75c-12d0cf37c7c9" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2024-12-24</th>
      <td>0.014444</td>
    </tr>
    <tr>
      <th>2024-12-26</th>
      <td>0.003679</td>
    </tr>
    <tr>
      <th>2024-12-27</th>
      <td>-0.010568</td>
    </tr>
    <tr>
      <th>2024-12-30</th>
      <td>-0.011812</td>
    </tr>
    <tr>
      <th>2024-12-31</th>
      <td>-0.007963</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-a0caac43-5dc3-4e8e-b75c-12d0cf37c7c9')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-a0caac43-5dc3-4e8e-b75c-12d0cf37c7c9 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-a0caac43-5dc3-4e8e-b75c-12d0cf37c7c9');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-51fd6674-77a7-4842-89d9-76982783dc84">
      <button class="colab-df-quickchart" onclick="quickchart('df-51fd6674-77a7-4842-89d9-76982783dc84')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-51fd6674-77a7-4842-89d9-76982783dc84 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
</section>
<section id="how-do-we-estimate-betas">
<h3><span class="section-number">8.4.2. </span>How do we estimate betas?<a class="headerlink" href="#how-do-we-estimate-betas" title="Link to this heading">#</a></h3>
<p>We run a regression!</p>
<ul class="simple">
<li><p>if we include a constant (as we should), the the regression slope of the asset on the factor is our beta</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\beta=\frac{Cov(r,f)}{Var(f)}\]</div>
<ul class="simple">
<li><p>We typically do not use the whole sample when using individual stocks‚Äìstocks behavior change. So we want the most up to date behavior</p></li>
<li><p>but cannot be too short otherwise you cannot say anything as estimation uncertainty will be very high!</p></li>
<li><p>Optimal look-back window will trade-off these forces and might vary according the asset/strategy</p></li>
<li><p>Academic literature likes to use between 1 year to 2 years if using daily data for stocks. Longer if betas of systematic trading strategies</p></li>
</ul>
<p>üëâ when working with illiquid stocks daily data might be problematic and weekly or monthly might be more advisable, but the sample period will have to be increased. For example, for monthly people use 5 years)</p>
<p>We will focus on simple regressions, and briefly discuss alternatives</p>
<p>‚ö° ‚è∞ Question: G1 ‚ö°
Complete the code below and abe prepared to answer the questions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#instead of using the smf api that uses formulas we will use the sm api that uses matrices</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;GE&#39;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span> <span class="c1"># this is to get the normal distribution</span>

<span class="c1">#1. How well is estimated? Recover the standard error</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">)</span>
<span class="c1">#2. Given this, how well it is estimated?</span>
<span class="c1">#3. Based on this how confident we are that the beta is more  than 1? ( this is qualitative)</span>
<span class="c1">#4. How much uncertainty do we have about it? what is the 95% confidence interval?</span>
<span class="nb">print</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span> <span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">],</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span> <span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]])</span>
<span class="c1">#5. How do I adjust the t-statistic to test if beta is greater than 1 (or any other number)?</span>
<span class="n">tstat</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span> <span class="o">-</span><span class="n">__</span><span class="p">)</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tstat</span><span class="p">)</span>
<span class="c1">#6. Given this t-statistic what is the probability that beta is greater than 1? And less than 1?</span>
<span class="n">probmorethan1</span><span class="o">=</span><span class="n">__</span><span class="o">-</span><span class="n">norm</span><span class="o">.</span><span class="n">__</span><span class="p">(</span><span class="n">tstat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">probmorethan1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>GE</td>        <th>  R-squared:         </th>  <td>   0.546</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.546</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>3.119e+04</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 17 Sep 2025</td> <th>  Prob (F-statistic):</th>   <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>18:48:54</td>     <th>  Log-Likelihood:    </th>  <td>  77611.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td> 25898</td>      <th>  AIC:               </th> <td>-1.552e+05</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td> 25896</td>      <th>  BIC:               </th> <td>-1.552e+05</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>      <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td> 2.159e-05</td> <td> 7.51e-05</td> <td>    0.287</td> <td> 0.774</td> <td>   -0.000</td> <td>    0.000</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    1.2313</td> <td>    0.007</td> <td>  176.612</td> <td> 0.000</td> <td>    1.218</td> <td>    1.245</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>5524.438</td> <th>  Durbin-Watson:     </th>  <td>   2.092</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>136801.661</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.427</td>  <th>  Prob(JB):          </th>  <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>14.227</td>  <th>  Cond. No.          </th>  <td>    92.8</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">/tmp/ipython-input-2159934377.py</span> in <span class="ni">&lt;cell line: 0&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> 
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1">#1. How well is estimated? What is the interpretation of the t-statistic?</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">__</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1">#2. Based on this how confident we are that the beta is more  than 1? ( this is qualitative)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1">#3. How much uncertainty do we have about it? what is the 95% confidence interval?</span>

<span class="nn">/usr/local/lib/python3.12/dist-packages/statsmodels/base/wrapper.py</span> in <span class="ni">__getattribute__</span><span class="nt">(self, attr)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>             <span class="k">pass</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> 
<span class="ne">---&gt; </span><span class="mi">34</span>         <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span>         <span class="n">data</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>         <span class="n">how</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

<span class="ne">AttributeError</span>: &#39;OLSResults&#39; object has no attribute &#39;__&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="is-this-too-good-to-be-true">
<h3><span class="section-number">8.4.3. </span>Is this too Good to be true?<a class="headerlink" href="#is-this-too-good-to-be-true" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>But is beta really constant?</p></li>
<li><p>Should we be using such a long sample?</p></li>
<li><p>Lets look at at 2 year periods</p></li>
<li><p>To do this efficiently we will use the groupby method</p></li>
<li><p>We will first create a function that does the regression and returns the beta</p></li>
</ul>
</section>
<section id="betas-over-time">
<h3><span class="section-number">8.4.4. </span>Betas over time<a class="headerlink" href="#betas-over-time" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Almost always above 1, but all over the place</p></li>
<li><p>are the betas really changing like that?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the Betas for each 2 year period</span>

<span class="c1"># We start by putting the factor and the excess return series together in a DataFrame called `df_m`.</span>
<span class="n">df_m</span><span class="o">=</span><span class="n">df_factor</span>
<span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;GE&#39;</span><span class="p">]</span>
<span class="c1"># now we define a function that does the regression and returns the beta</span>
<span class="k">def</span><span class="w"> </span><span class="nf">regression_beta</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to estimate the beta of a stock using OLS regression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="c1">######################################</span>
<span class="n">df_m</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">regression_beta</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/5d67ceb4654d16bcd5a6a8812e78206a8bc0c564332958e5641a76dddc500628.png" src="../../_images/5d67ceb4654d16bcd5a6a8812e78206a8bc0c564332958e5641a76dddc500628.png" />
</div>
</div>
<section id="note-function-definition">
<h4><span class="section-number">8.4.4.1. </span>üêç Note: function definition<a class="headerlink" href="#note-function-definition" title="Link to this heading">#</a></h4>
<p>We can build our own function as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">name_of_function</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span><span class="n">input2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">inputA</span><span class="o">=</span><span class="s1">&#39;defaultA&#39;</span><span class="p">,</span><span class="o">..</span><span class="p">,</span><span class="n">inputZ</span><span class="o">=</span><span class="s1">&#39;defaultZ&#39;</span><span class="p">):</span>
    <span class="n">Write</span> <span class="nb">all</span> <span class="n">you</span> <span class="n">want</span> <span class="n">the</span> <span class="n">function</span> <span class="n">to</span> <span class="n">do</span>
    <span class="n">LINE</span>
    <span class="n">LINE</span>
    <span class="k">as</span> <span class="n">long</span> <span class="n">it</span> <span class="n">has</span> <span class="mi">4</span> <span class="n">white</span> <span class="n">spaces</span> <span class="n">it</span> <span class="n">will</span> <span class="n">belong</span> <span class="n">to</span> <span class="n">the</span> <span class="n">function</span>
    <span class="k">return</span> <span class="n">Whaterver_you_want_to_return_if_anything</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">regression_beta</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to estimate the beta of a stock using OLS regression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>


<span class="n">regression_beta</span><span class="p">(</span><span class="n">df_m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="note-groupby">
<h4><span class="section-number">8.4.4.2. </span>üêç Note: Groupby<a class="headerlink" href="#note-groupby" title="Link to this heading">#</a></h4>
<p>this is the first time we see the groupby method in pandas</p>
<ul class="simple">
<li><p>Groupby is a method in pandas that allows you to group data based on some criteria (e.g., a column or a function applied to the index).</p></li>
<li><p>Once grouped, you can apply aggregation or transformation functions (e.g., mean, sum, or custom functions) to each group independently.</p></li>
<li><p>The grouping can be based on labels, index levels, or a custom function applied to the index or columns.</p></li>
<li><p>After applying the function, the results are combined into a new DataFrame or Series.</p></li>
</ul>
<p>Here the line that will estimate the rolling betas for us</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">regression_beta</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>now there is a lot going on in this line, so let‚Äôs break it down step by step:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.groupby((df.index.year</span> <span class="pre">//</span> <span class="pre">2)</span> <span class="pre">*</span> <span class="pre">2)</span></code>: The data is grouped by two-year periods.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.index.year</span></code> extracts the year from the index (assumed to be a datetime index).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.index.year</span> <span class="pre">//</span> <span class="pre">2</span></code> divides the year by 2 (integer division) to group years into two-year blocks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*</span> <span class="pre">2</span></code> converts the two-year blocks back to the starting year of the block (e.g., 2020 and 2021 are grouped as 2020).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.apply(regression_beta)</span></code>: For each two-year group, the regression_beta function is applied which must return the beta for the sample period</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.plot()</span></code>: The extracted beta values for each two-year period are plotted to visualize how the beta changes over time.</p></li>
</ol>
<blockquote>
<div><p>how do I change to have 1 year periods? and 6 month periods?</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the group</span>
<span class="n">_temp</span><span class="o">=</span><span class="n">df_m</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">_temp</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">display</span><span class="p">(</span><span class="n">_temp</span><span class="p">[</span><span class="s1">&#39;2001-12-26&#39;</span><span class="p">:</span><span class="s1">&#39;2002-1-4&#39;</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">_temp</span><span class="p">[</span><span class="s1">&#39;2002-12-26&#39;</span><span class="p">:</span><span class="s1">&#39;2003-1-4&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="uncertainty">
<h3><span class="section-number">8.4.5. </span>Uncertainty<a class="headerlink" href="#uncertainty" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>We are looking at point <strong>estimates</strong></p></li>
<li><p>The variation in the data might be just sample uncertainty</p></li>
<li><p>We will now construct standard errors and confidence intervals to gauge whether this variation is real or a mirage</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_m</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df_m</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1">#How do the standard errors compare with the full sample one?</span>

<span class="c1"># is that surprising? Explain what is going on</span>

<span class="c1"># Might be useful to look at different sampling (30,5,2,1) to get intuition</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/52c26036103663291a0af60ab0ee5cba8664f97c7dc3c0f9f45d7b2266a2f268.png" src="../../_images/52c26036103663291a0af60ab0ee5cba8664f97c7dc3c0f9f45d7b2266a2f268.png" />
</div>
</div>
<section id="note-anonymous-function-lambda">
<h4><span class="section-number">8.4.5.1. </span>üêç Note : Anonymous Function (lambda)<a class="headerlink" href="#note-anonymous-function-lambda" title="Link to this heading">#</a></h4>
<p>Above was the first time we use the an anonymous function (lambda):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

</pre></div>
</div>
<ul class="simple">
<li><p>A lambda function is an anonymous function defined using the <code class="docutils literal notranslate"><span class="pre">lambda</span></code> keyword.</p></li>
<li><p>It is used to create small, one-line functions without formally defining them using <code class="docutils literal notranslate"><span class="pre">def</span></code>.S</p></li>
<li><p>In this case, the lambda function takes a DataFrame <code class="docutils literal notranslate"><span class="pre">x</span></code> as input and performs the following steps:</p></li>
</ul>
<ol class="arabic simple">
<li><p>Fits an OLS regression model using <code class="docutils literal notranslate"><span class="pre">x['re']</span></code> as the dependent variable and <code class="docutils literal notranslate"><span class="pre">x['Mkt-RF']</span></code> as the independent variable.</p></li>
<li><p>Extracts the standard error of the coefficient for <code class="docutils literal notranslate"><span class="pre">Mkt-RF</span></code> from the fitted model.</p></li>
<li><p>The lambda function is applied to each group created by the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> method.</p></li>
</ol>
</section>
<section id="confidence-intervals">
<h4><span class="section-number">8.4.5.2. </span>Confidence Intervals<a class="headerlink" href="#confidence-intervals" title="Link to this heading">#</a></h4>
<ol class="arabic simple">
<li><p>Get point estimates: e</p></li>
<li><p>Get standard errors: se</p></li>
<li><p>Construct Confidence bands using [e - 1.96 * se, e + 1.96 * se] for a 95% CI</p></li>
</ol>
<p><strong>‚ö° ‚è∞ Question: G2 ‚ö° how do I adjust the code below so it is a function that takes the size of the lookback window and the size of the confidence interval as inputs? (explain it!)</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets plot the point estimates and the confidence intervals</span>
<span class="n">y</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># # you can change this to 5, 10, etc. to change the size of the sample</span>
<span class="n">se</span><span class="o">=</span><span class="n">df_m</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df_m</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">e</span><span class="o">=</span><span class="n">df_m</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df_m</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">e</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">se</span><span class="p">,</span> <span class="n">e</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">se</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Coefficient Over Time with 95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/47ea341073a07bb69648107b4d76feb29bb6ff820af50f97a59c3f9ad1e76e89.png" src="../../_images/47ea341073a07bb69648107b4d76feb29bb6ff820af50f97a59c3f9ad1e76e89.png" />
</div>
</div>
</section>
<section id="what-question-these-standard-errors-confidence-intervals-answer">
<h4><span class="section-number">8.4.5.3. </span>What question these standard errors/confidence intervals answer?<a class="headerlink" href="#what-question-these-standard-errors-confidence-intervals-answer" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>They speak to the distribution of beta in sample‚Äìthat is‚Äì</p></li>
<li><p>Given the particular data, what is the distribution of beta consistent with it</p></li>
<li><p>That is only relevant <strong>if</strong> these moments are constant</p></li>
<li><p>Our estimation seems fairly confident of the beta on a particular year, but we need to know the beta NEXT year‚Äìor at the very least next month</p></li>
<li><p>So lets look how past beta is associated with future beta</p></li>
</ul>
<p>üêç Note : .shift(d) method</p>
<ul class="simple">
<li><p>Shift the variance series by d periods to create the lagged variable,</p></li>
<li><p>i.e. if d=1 use the previous month‚Äôs variance as a predictor for the current month‚Äôs variance</p></li>
<li><p>When you shift the series, the first row will be NaN because there is no previous month for the first month</p></li>
<li><p>if you were to use -1 you would be using the next month‚Äôs variance as a predictor for the current month‚Äôs variance. would that make sense? No, because you would be using future information to predict the past</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">e</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lagged Coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficient&#39;</span><span class="p">)</span>
<span class="c1"># There is a relationship</span>
<span class="c1"># But is the variation consistent with the standard errors?</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="it-is-a-forecasting-problem">
<h4><span class="section-number">8.4.5.4. </span>It is a Forecasting Problem!<a class="headerlink" href="#it-is-a-forecasting-problem" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>How do we interpret these coefficients?</p></li>
<li><p>What is your best guess of next year beta given this year beta?</p></li>
<li><p>Is this good?</p></li>
<li><p>A more humble approach‚Äìand what people typically do‚Äìis to use the last 2 years of data to predict next month beta‚Äìthat does much better</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exponential-decay-models">
<h3><span class="section-number">8.4.6. </span>Exponential decay models<a class="headerlink" href="#exponential-decay-models" title="Link to this heading">#</a></h3>
<p>People in the industry also like exponential decay models</p>
<p>Instead of simply ignoring past observations, you instead put less weight on them</p>
<p>Instead of OLS you do GLS with weights given by</p>
<div class="math notranslate nohighlight">
\[W_t=\frac{e^{-\delta(T-t)}}{\sum_t^T e^{-\delta(T-t)}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
<span class="n">n</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">decay_rate</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># Lambda controls the decay rate</span>

<span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">decay_rate</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Reverse order for recent weights</span>
<span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># Normalize weights to sum to 1 (optional)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Weights Over Time&#39;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="variances">
<h2><span class="section-number">8.5. </span>Variances<a class="headerlink" href="#variances" title="Link to this heading">#</a></h2>
<p>Variances come in two flavors. Factor variance and idiosyncratic variance.</p>
<p>Both tend to move together at high frequencies (days, weeks, a few months)</p>
<p>At horizons longer than 1 year, you are better off with low frequency estimates of variances‚Äìsay use a two year-five year sample of daily returns</p>
<p>For investment horizons shorter than a month you certainly need to pay attention to higher frequency variation. So you might estimate using 3-month, 1-month , and even one day of data using minute-by-minute data</p>
<p>Lets start with the factor variance, that is the variance of the market</p>
<ul class="simple">
<li><p>For intuition I will  annualize it and look at standard deviation instead of variance</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<section id="variances-over-time">
<h3><span class="section-number">8.5.1. </span>Variances Over time<a class="headerlink" href="#variances-over-time" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Average volatility  is 17% in a year‚Äìwith a premium of 5% this means 16% of the time I will lose 12% of my money in 1 year, or get 22% return!</p></li>
<li><p>Does it move around? Say is vol across years very similar?</p></li>
<li><p>At the peak what is the 16% worst case investors have for their portfolio?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">252</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="note-rolling-method">
<h3><span class="section-number">8.5.2. </span>üêç Note : Rolling method<a class="headerlink" href="#note-rolling-method" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The rolling method calculates a moving window statistic (e.g., mean, std) over a specified window size.
Here, it computes the standard deviation of ‚ÄòMkt-RF‚Äô for the last 252 observations at each point in time.</p></li>
<li><p>This provides a time series of rolling standard deviations, which is then annualized and plotted.</p></li>
<li><p>Note that the windows overlap so rolling will naturally look persistent‚Äìso don‚Äôt be deceived</p></li>
</ul>
</section>
<section id="nobel-insight">
<h3><span class="section-number">8.5.3. </span>Nobel insight<a class="headerlink" href="#nobel-insight" title="Link to this heading">#</a></h3>
<p>Rob Engle won the nobel prize for developing models that forecast volatility.</p>
<p><img alt="Robert F. Engle" src="https://www.stern.nyu.edu/faculty/static/photos/rengle.jpg?v=20250812154103" /></p>
<p>Practicioners use very rich models ARCH, GARCH, Multi-frequency AR models, and also data from option markets‚Äìfor example the VIX</p>
<p>Here I will do a simple regression based on the idea that volatility is persistence</p>
<p>We will estimate an AR(1) model</p>
<div class="math notranslate nohighlight">
\[RV_{t+1}=a+bRV_t+\epsilon_{t+1}\]</div>
<ul class="simple">
<li><p>If vol persistent‚Äìsurely looks like it‚Äìb&gt;0 and past vol allow us to forecast future vol</p></li>
<li><p>I will also use the VIX, which is the ‚Äúmarket expectation‚Äù of the next 30 day volatility in the market</p></li>
</ul>
</section>
<section id="realized-variance">
<h3><span class="section-number">8.5.4. </span>Realized Variance<a class="headerlink" href="#realized-variance" title="Link to this heading">#</a></h3>
<ul>
<li><p>Using daily data for month t, construct the market return ‚Äúrealized variance‚Äù during month t</p>
<div class="math notranslate nohighlight">
\[rv_t=\sum_{d \in days~ in ~month ~t}\frac{(r_d- \overline{r})^2}{N_{days}},\]</div>
</li>
</ul>
<p>where <span class="math notranslate nohighlight">\(\overline{r}\)</span> is the average return within the month</p>
<p>üêç Note : Group the data by month-end dates</p>
<ul class="simple">
<li><p>pd.offsets.MonthEnd(0) ensures that the grouping aligns with the month-end of each date</p></li>
<li><p>so all returns in the same month are grouped together</p></li>
<li><p>So I can just compute the variance of this group (say 1/1/2020,1/2/2020,‚Ä¶1/31/2020) will all be associated with 1/31/2020</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_var</span><span class="o">=</span><span class="n">df_m</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_m</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
<span class="p">(</span><span class="n">df_var</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># now there is no overlapping data points</span>
<span class="c1"># We see a lot of clustering--so volatility is persistent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/a816efa30f2e5cd179fa98575e8bc26c346f70a1b301b081f96df5f1dfab90ef.png" src="../../_images/a816efa30f2e5cd179fa98575e8bc26c346f70a1b301b081f96df5f1dfab90ef.png" />
</div>
</div>
</section>
<section id="forecasting-realized-variance">
<h3><span class="section-number">8.5.5. </span>Forecasting Realized Variance<a class="headerlink" href="#forecasting-realized-variance" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>you see we can forecast quite a bit of variation even with a only using the last month variance</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>


<span class="c1"># Shift the variance series by one period to create the lagged variable</span>
<span class="n">df_var_lag</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Drop the first row with NaN value</span>
<span class="c1"># you have to drop in both series to align them correctly for regression</span>
<span class="n">df_var</span> <span class="o">=</span> <span class="n">df_var</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">df_var_lag</span> <span class="o">=</span> <span class="n">df_var_lag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="c1"># Define the independent variable (lagged variance) and add a constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_var_lag</span><span class="p">)</span>
<span class="c1"># Define the dependent variable (current variance)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_var</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.291
Model:                            OLS   Adj. R-squared:                  0.290
Method:                 Least Squares   F-statistic:                     483.3
Date:                Wed, 17 Sep 2025   Prob (F-statistic):           4.84e-90
Time:                        18:49:20   Log-Likelihood:                 1878.5
No. Observations:                1181   AIC:                            -3753.
Df Residuals:                    1179   BIC:                            -3743.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0132      0.002      8.268      0.000       0.010       0.016
0              0.5392      0.025     21.984      0.000       0.491       0.587
==============================================================================
Omnibus:                     1662.117   Durbin-Watson:                   2.053
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           536023.896
Skew:                           7.763   Prob(JB):                         0.00
Kurtosis:                     106.208   Cond. No.                         17.1
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
</section>
<section id="forecasting-with-market-views">
<h3><span class="section-number">8.5.6. </span>Forecasting with market views<a class="headerlink" href="#forecasting-with-market-views" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Investors trade options on the SP500, which is 99% correlated with the total market portfolio</p></li>
<li><p>One can prove that the payoff a certain portfolio  of these options is exactly the variance of the underlying, i.e. the SP500, for the maturity of the option</p></li>
<li><p>So if you add up the option prices and weight them appropriately we have exactly the price of the portfolio that pays the variance</p></li>
<li><p>the price of this portfolio is the VIX index (in fact it is the square-root of the price of the portfolio)</p></li>
</ul>
<p>Suppose at month t, you expect variance next month be <span class="math notranslate nohighlight">\((5\%)^2\)</span></p>
<ul class="simple">
<li><p>You open your bloomberg and you see that  <span class="math notranslate nohighlight">\(VIX^2_t&lt;(5\%)^2\)</span>, what should you do?</p></li>
<li><p>And IF <span class="math notranslate nohighlight">\(VIX^2_t&gt;(5\%)^2\)</span>, what should you do?</p></li>
<li><p>What does this tell us?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get VIX data from FRED</span>
<span class="n">vix</span> <span class="o">=</span> <span class="n">DataReader</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;VIXCLS&quot;</span><span class="p">,</span> <span class="s2">&quot;fred&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">df_var</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_var</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">vix</span> <span class="o">=</span> <span class="n">vix</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>  <span class="c1"># Resample to monthly and take the last value</span>
<span class="n">vix</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipython-input-22081174.py:3: FutureWarning: &#39;M&#39; is deprecated and will be removed in a future version, please use &#39;ME&#39; instead.
  vix = vix.resample(&#39;M&#39;).last()  # Resample to monthly and take the last value
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;DATE&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/564d6533b0beb8021dcd2f0b2147b433cbb2a30616c75b1596e43726dfcb850e.png" src="../../_images/564d6533b0beb8021dcd2f0b2147b433cbb2a30616c75b1596e43726dfcb850e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge VIX data with df_var</span>
<span class="n">df_var_vix</span> <span class="o">=</span> <span class="n">df_var</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;realized_variance&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">vix</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Shift the variance series by one period to create the lagged variable</span>
<span class="n">df_var_vix</span><span class="p">[</span><span class="s1">&#39;VIX_lagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_var_vix</span><span class="p">[</span><span class="s1">&#39;VIXCLS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_var_vix</span><span class="p">[</span><span class="s1">&#39;realized_variance_lagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_var_vix</span><span class="p">[</span><span class="s1">&#39;realized_variance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Drop the first row with NaN value</span>
<span class="n">df_var_vix</span> <span class="o">=</span> <span class="n">df_var_vix</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Define the independent variables (lagged variance and VIX) and add a constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_var_vix</span><span class="p">[[</span><span class="s1">&#39;realized_variance_lagged&#39;</span><span class="p">,</span> <span class="s1">&#39;VIX_lagged&#39;</span><span class="p">]])</span>
<span class="c1"># Define the dependent variable (current variance)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_var_vix</span><span class="p">[</span><span class="s1">&#39;realized_variance&#39;</span><span class="p">]</span>
<span class="c1"># Fit the OLS model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the model summary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:      realized_variance   R-squared:                       0.380
Model:                            OLS   Adj. R-squared:                  0.377
Method:                 Least Squares   F-statistic:                     127.6
Date:                Wed, 17 Sep 2025   Prob (F-statistic):           6.25e-44
Time:                        18:49:34   Log-Likelihood:                 653.74
No. Observations:                 419   AIC:                            -1301.
Df Residuals:                     416   BIC:                            -1289.
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
============================================================================================
                               coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------------------
const                       -0.0089      0.004     -2.226      0.027      -0.017      -0.001
realized_variance_lagged     0.0552      0.065      0.852      0.395      -0.072       0.183
VIX_lagged                   0.9155      0.104      8.813      0.000       0.711       1.120
==============================================================================
Omnibus:                      673.771   Durbin-Watson:                   1.740
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           224217.046
Skew:                           8.939   Prob(JB):                         0.00
Kurtosis:                     114.908   Cond. No.                         47.3
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
</section>
<section id="idiosyncratic-volatility">
<h3><span class="section-number">8.5.7. </span>Idiosyncratic  Volatility<a class="headerlink" href="#idiosyncratic-volatility" title="Link to this heading">#</a></h3>
<p>Lets look now at the idiosyncratic component</p>
<p>Recall that</p>
<div class="math notranslate nohighlight">
\[\epsilon=r^e-(\alpha+\beta*f)\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[Var(\epsilon)=Var(r^e-\beta*f)\]</div>
<p>So the variance of the idio component very much depends on your estimate of beta.</p>
<p>Here we will fix our beta estimate for the whole sample and then look at variation in the volatility of residuals the same we did for the variance of the market</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_m</span><span class="o">=</span><span class="n">df_m</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span>
<span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">252</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;epsilon&#39;</span><span class="p">,</span><span class="s1">&#39;idio vol&#39;</span><span class="p">,</span><span class="s1">&#39;mkt vol&#39;</span><span class="p">])</span>
<span class="c1"># what do we learn?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7d28070c4e00&gt;
</pre></div>
</div>
<img alt="../../_images/98a396882dc8cc2d52487d5349b9ed4d29eed6f0a6ea20794ddfb2a5ec8a9da7.png" src="../../_images/98a396882dc8cc2d52487d5349b9ed4d29eed6f0a6ea20794ddfb2a5ec8a9da7.png" />
</div>
</div>
</section>
<section id="question-g3">
<h3><span class="section-number">8.5.8. </span>‚ö° ‚è∞ Question: G3 ‚ö°<a class="headerlink" href="#question-g3" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>How do you do this using the Realized Variance (non-overlapping) approach?</p></li>
<li><p>What models you would try to forecast indio vol? Be concrete!</p></li>
</ul>
</section>
</section>
<section id="cross-section-vs-time-series">
<h2><span class="section-number">8.6. </span>Cross-Section vs Time-series<a class="headerlink" href="#cross-section-vs-time-series" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Variances tend to move up and down together</p></li>
<li><p>you can repeat the forecasting exercise we did for the market variance to check out degree of  variation</p></li>
<li><p>One thing that will be really important is to be able to detect variation in these moments (variance, beta) across stocks</p></li>
<li><p>Here we are exploring the extent we can detect variation over time, but lots of trading strategies will be about comparing different stocks and be able to tell which one is more volatile going forward</p></li>
<li><p>Predicting if a high beta stock is still high beta next month is easier, but harder to do</p></li>
<li><p>For this we need to üí™-up our Pandas skills in order to work with many stocks at the same time</p></li>
</ul>
</section>
<section id="expected-returns">
<h2><span class="section-number">8.7. </span>Expected returns<a class="headerlink" href="#expected-returns" title="Link to this heading">#</a></h2>
<p>Expected returns have three components</p>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha + b*E[f]\]</div>
<ul class="simple">
<li><p>the risk-free rate‚Äì&gt; directly observed in financial markets</p></li>
<li><p>The Factor risk-premia</p></li>
<li><p>The alpha</p></li>
</ul>
<section id="factor-risk-premia">
<h3><span class="section-number">8.7.1. </span>Factor Risk-Premia<a class="headerlink" href="#factor-risk-premia" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>While conceptually both alpha and risk premia are both expected excess returns, in practice our approach is very different</p></li>
<li><p>Factor risk-premia likely move around, but we think of then as a more stable features of the economic environment</p></li>
<li><p>They are compensation for systematic risk, so they don‚Äôt go away just because investors are aware of it</p></li>
<li><p>We are more comfortable in using long data sets to measure it</p></li>
</ul>
<p>We will now look at the risk-premia on the market and discuss how to think about the estimation, how to think about the precision of these estimates and briefly discuss how it might move around over time</p>
<p><strong>If We think a risk-premia does not move too much over time, then our best estimate is the sample average of the longest sample we can put our hands on</strong></p>
<div class="math notranslate nohighlight">
\[\hat{E}[r^e]=\frac{1}{T}\sum_{t=1}^T r^e_t\]</div>
<ul class="simple">
<li><p>If observations are serially uncorrelated over time then the standard deviation of a sample average is simply</p></li>
</ul>
<div class="math notranslate nohighlight">
\[se(\hat{E}[r^e])=\sqrt{\frac{Var(r^e_t)}{T}}\]</div>
<ul class="simple">
<li><p>Returns of most <em>liquid</em> assets are sufficiently close to uncorrelated over time for this assumption to be ok</p></li>
<li><p>It is also easy enough to adjust for serial correlation which we can  be done using a regression library.</p></li>
<li><p>The longer the sample, the higher our precision, the lower the standard errors</p></li>
<li><p>The higher the asset variance, the higher our standard errors, the lower our precision</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Daily is really ugly. Lets look at annual quantities</span>
<span class="c1">#The mean is multiplied by 252, because there are 252 days in a year</span>
<span class="c1">#Variance is also multiplied by 252, so standard-deviation gets multiplied by square root of it</span>
<span class="c1">#The number of observations are divided by 252 because now things are in years</span>

<span class="c1"># Calculate the average for the market</span>
<span class="n">market_average</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">market_std_dev</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">T</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_m</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">252</span><span class="p">)</span>
<span class="c1"># Calculate the standard error of the average</span>
<span class="n">market_average_std_error</span> <span class="o">=</span> <span class="n">market_std_dev</span> <span class="o">/</span> <span class="n">T</span><span class="o">**</span> <span class="mf">0.5</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market standard deviation: </span><span class="si">{</span><span class="n">market_std_dev</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Calculate the standard error of the average</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Market Average: </span><span class="si">{</span><span class="n">market_average</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error of the Average: </span><span class="si">{</span><span class="n">market_average_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-stat relative to zero null: </span><span class="si">{</span><span class="p">(</span><span class="n">market_average</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">market_average_std_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># what do you notice about the t-stat?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Market standard deviation: 0.17101250291289558
Market Average: 0.07742251911344505
Standard Error of the Average: 0.016869220711097928
t-stat relative to zero null: 4.589572952976441
</pre></div>
</div>
</div>
</div>
<p>üëâThis makes the very important point that <strong>sampling more frequently does not lead to more precise estimates of the expected return</strong></p>
<p>üëâ ‚Äúonly time will tell‚Äù could not be any truer for means: Both mean and variance are scaled up by the frequency.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nullh</span><span class="o">=</span><span class="mf">0.03</span>
<span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="n">market_average</span><span class="o">-</span><span class="n">nullh</span><span class="p">)</span><span class="o">/</span><span class="n">market_average_std_error</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-stat relative to </span><span class="si">{</span><span class="n">nullh</span><span class="si">}</span><span class="s2"> null: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1">#what the interpretation of p?</span>
<span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sample-sizes-and-learning-about-means">
<h3><span class="section-number">8.7.2. </span>Sample sizes and learning about means<a class="headerlink" href="#sample-sizes-and-learning-about-means" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Suppose risk-premium is time-varying but moves  slowly</p></li>
<li><p>Also lets suppose the variance is constant</p></li>
<li><p>How long a sample do I need to be 95% confident that the expected value is higher than a given value, say 5%</p></li>
</ul>
<p>I need</p>
<div class="math notranslate nohighlight">
\[tstat&gt;F^{-1}(0.95)=1.64\]</div>
<div class="math notranslate nohighlight">
\[tstat=\frac{\hat{E}[r^e]-x}{se(\hat{E}[r^e])}&gt;F^{-1}(0.95)=1.64\]</div>
<div class="math notranslate nohighlight">
\[tstat=\frac{\hat{E}[r^e]-x}{\sqrt{\frac{Var(r^e_t)}{T}}}&gt;F^{-1}(0.95)=1.64\]</div>
<p>manipulating</p>
<div class="math notranslate nohighlight">
\[\sqrt{T}\frac{\hat{E}[r^e]-x}{\sigma(r^e_t)}=1.64\]</div>
<div class="math notranslate nohighlight">
\[T=1.64^2*\left(\frac{\hat{E}[r^e]}{\sigma(r^e_t)}-\frac{x}{\sigma(r^e_t)}\right)^{-2}\]</div>
<ul class="simple">
<li><p>what is this term <span class="math notranslate nohighlight">\(\frac{\hat{E}[r^e]}{\sigma(r^e_t)}\)</span> called?</p></li>
<li><p>The more confident you want to be, the longer the sample you need</p></li>
<li><p>The more volatile the asset the longer the sample</p></li>
<li><p>The higher the expected value you have for the asset, the shorter the sample</p></li>
<li><p>in the case of x=0 this becomes</p></li>
</ul>
<div class="math notranslate nohighlight">
\[T=1.64^2*\left(\frac{\hat{E}[r^e]}{\sigma(r^e_t)}\right)^{-2}\]</div>
<p>Suppose we have an asset with similar moments as the market</p>
<p>how long a sample do I expect to need to be confident that the asset has indeed positive mean?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quantile</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">value_at_quantile</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">quantile</span><span class="p">)</span>
<span class="n">sr</span><span class="o">=</span><span class="n">market_average</span><span class="o">/</span><span class="n">market_std_dev</span>
<span class="p">(</span><span class="n">sr</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">value_at_quantile</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(13.200052067961026)
</pre></div>
</div>
</div>
</div>
<p>‚ö° ‚è∞ Question: G4 ‚ö°</p>
<ol class="arabic simple">
<li><p>What does it tell you about opening a hedge fund? This about the investors and their problem</p></li>
<li><p>What this tell you about pod shops looking for very high SR strategies? How this makes high SR strategies extra desirable?</p></li>
</ol>
</section>
<section id="detecting-time-variation-in-means">
<h3><span class="section-number">8.7.3. </span>Detecting time-variation in means<a class="headerlink" href="#detecting-time-variation-in-means" title="Link to this heading">#</a></h3>
<p>Lets look at the market splitting it in 15 year periods</p>
<ul class="simple">
<li><p>even then there would be multiple 15 year periods where we would not be 95% sure that the market has a positive expected return</p></li>
<li><p>If you think the market risk-premium moves much faster than this, then the sample mean is fairly unreliable estimator</p></li>
<li><p>This insight will be very important to think about alphas. Why?</p></li>
<li><p>This also tells you that timing the market based on past performance‚Äìeven 15 past performance is a disaster!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">=</span><span class="mi">15</span>
<span class="n">a</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.64</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1.64 Threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Huge literature tries to forecast market return</p>
<ul class="simple">
<li><p>They use past volatility (bad, does not work at all)</p></li>
<li><p>Dividend yield (maybe, a bit unreliable)</p></li>
<li><p>earnings yield (similar for dividend yield)</p></li>
<li><p>‚ÄúVariance-Risk Premium‚Äù, basically the VIX minus past vol‚Äìthat works a bit better, but sample is short, so hard to be sure</p></li>
</ul>
<p>In the end of the day it comes down to</p>
<div class="math notranslate nohighlight">
\[r_{t+1}=a+bX_t+\epsilon_{t+1}\]</div>
<p>where anything that is known at date <span class="math notranslate nohighlight">\(t\)</span> is a valid trading signal (past vol,‚Ä¶)</p>
<p>It is very tricky business</p>
<p>We will look at this in our timing lecture</p>
</section>
</section>
<section id="alpha-is-all-you-need">
<h2><span class="section-number">8.8. </span>Alpha is all you need<a class="headerlink" href="#alpha-is-all-you-need" title="Link to this heading">#</a></h2>
<p>In one way estimating an alpha is similar to estimating factor risk-premia</p>
<ul class="simple">
<li><p>Both are expected values of the excess returns</p></li>
<li><p>Alpha is the expected value of the hedged portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\alpha=E[r^e-\beta f]\]</div>
<ul class="simple">
<li><p>So you might think the longer the sample, the better right?</p></li>
<li><p>But while for factor premia we have lots of theory telling us that it should move very slowly</p>
<ul>
<li><p>it is about aggregate risk‚Äìand it should not go away just because people know it</p></li>
<li><p>people might choose not to go all in because it is risky!</p></li>
</ul>
</li>
<li><p>For alphas, it is the opposite, everyone is jumping when alpha is detected. The whole point is that alpha, real alpha, are premiums that you earn after you HEDGE out any aggregate factor exposure your portfolio have</p></li>
<li><p>What happens with the price as more people buy an asset?</p></li>
<li><p>What happens with the asset actual long-term value?</p></li>
<li><p>What happens with the alpha?</p></li>
</ul>
<p>So lets first get a few stocks and compare their alphas.</p>
<ul class="simple">
<li><p>I will estimate for each stock their alpha in a 1-year sample and compare with the alpha the following 1 year</p></li>
<li><p>But you should free to be creative here. You could use 1 year to predict a month and so on</p></li>
<li><p>The goal here is to show one way of doing things‚Äìbut there are many other similar ways</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## uncomment to use WRDS to get data</span>
<span class="c1"># conn = wrds.Connection()</span>
<span class="c1"># tickers=[&#39;MSFT&#39;,&#39;AAPL&#39;,&#39;CSCO&#39;,&#39;ORCL&#39;,&#39;GOOGL&#39;]</span>
<span class="c1"># df= get_daily_wrds(conn,tickers).dropna()</span>
<span class="c1"># df.to_csv(&#39;../../assets/data/FactorModelsEstimation_data2.csv&#39;)</span>
<span class="c1">#######################################</span>

<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/amoreira2/UG54/refs/heads/main/assets/data/FactorModelsEstimation_data2.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df_factor</span> <span class="o">=</span> <span class="n">get_factors</span><span class="p">()</span>
<span class="n">df</span><span class="p">,</span> <span class="n">df_factor</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df_factor</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_re</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">df_re</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipython-input-1066857734.py:38: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  fama_french = DataReader.DataReader(&quot;F-F_Research_Data_Factors_daily&quot;, &quot;famafrench&quot;,start=&quot;1921-01-01&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                MSFT      AAPL      CSCO      ORCL     GOOGL
2004-08-20  0.002900  0.002881 -0.011568 -0.010607  0.079434
2004-08-23  0.004362  0.009041  0.015840 -0.001020  0.010014
2004-08-24 -0.000050  0.027942 -0.010999  0.002863 -0.041458
2004-08-25  0.011330  0.034379  0.018400  0.006726  0.010725
2004-08-26 -0.004043  0.048664 -0.007814 -0.016396  0.017969
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/3c8dfe8bca52a61876338ab339649359fc31389963c7eade2e7636446588617f.png" src="../../_images/3c8dfe8bca52a61876338ab339649359fc31389963c7eade2e7636446588617f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the period length</span>
<span class="n">period_length</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Create a dictionary to store the results</span>
<span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Ticker&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Period&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Alpha_SE&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Alpha_Tstat&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="c1"># Loop through each 5-year period</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">_</span><span class="p">(),</span> <span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">_</span><span class="p">(),</span> <span class="n">_</span><span class="p">):</span>
    <span class="n">end_year</span> <span class="o">=</span> <span class="n">start_year</span> <span class="o">+</span> <span class="n">period_length</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">period_label</span> <span class="o">=</span> <span class="n">end_year</span>

    <span class="c1"># What these three lines are doing?</span>
    <span class="n">period_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)</span>
    <span class="n">df_re_period</span> <span class="o">=</span> <span class="n">df_re</span><span class="p">[</span><span class="n">period_mask</span><span class="p">]</span>
    <span class="n">df_factor_period</span> <span class="o">=</span> <span class="n">df_factor</span><span class="p">[</span><span class="n">period_mask</span><span class="p">]</span>

    <span class="c1"># Loop through each column in df_re</span>
    <span class="k">for</span> <span class="n">__</span> <span class="ow">in</span> <span class="n">__</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">df_re_period</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_factor_period</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="c1"># Store the results</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_label</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Alpha_SE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="s1">&#39;Alpha_Tstat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="c1"># Convert the results dictionary to a DataFrame</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>

<span class="c1"># Display the results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Ticker  Period     Alpha  Alpha_SE  Alpha_Tstat
0    MSFT    2004 -0.024998  0.173270    -0.144270
1    AAPL    2004  1.813820  0.695292     2.608718
2    CSCO    2004 -0.453783  0.381393    -1.189802
3    ORCL    2004  0.337930  0.490314     0.689211
4   GOOGL    2004  1.875742  0.880526     2.130251
..    ...     ...       ...       ...          ...
95   MSFT    2023  0.231046  0.205052     1.126763
96   AAPL    2023  0.167875  0.146782     1.143703
97   CSCO    2023 -0.080818  0.180123    -0.448682
98   ORCL    2023  0.075019  0.273346     0.274449
99  GOOGL    2023  0.202679  0.248743     0.814816

[100 rows x 5 columns]
</pre></div>
</div>
</div>
</div>
<section id="note-stacked-data-sets">
<h3><span class="section-number">8.8.1. </span>üêç Note : Stacked data sets<a class="headerlink" href="#note-stacked-data-sets" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Note that we know need two coordinates to identify one observation: Ticker and Period</p></li>
<li><p>To visualize this we want to plot the alpha of company A in year Y against the same company alpha in year Y+1</p></li>
<li><p>Can we simply use the shift operator like this?</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span><span class="n">results_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>‚ö° ‚è∞ Question: G4 ‚ö°</p>
<ul class="simple">
<li><p>if yes, why it works?</p></li>
<li><p>If not, how do we fix it?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot Alpha(t-1) vs Alpha(t)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">__</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha (t-1)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Alpha (t)&#39;</span><span class="p">)</span>

<span class="c1"># Plot Alpha_Tstat(t-1) vs Alpha(t)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">__</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Alpha_Tstat&#39;</span><span class="p">],</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha_Tstat (t-1)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Alpha (t)&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># Adjust layout to prevent overlapping titles/labels</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ae86264b0bb21b16a916face0f0dd523c196cb05caf7931a6351072724ad6f01.png" src="../../_images/ae86264b0bb21b16a916face0f0dd523c196cb05caf7931a6351072724ad6f01.png" />
</div>
</div>
<ul class="simple">
<li><p>You see that no matter the horizon there is no PREDICTIVE relationship, last period alpha is not related to future period alpha</p></li>
<li><p>You see that even if you sort on t-stat, it is not better</p></li>
<li><p>Even quite high T-stats are not associated with higher future alphas</p></li>
<li><p>This is not surprising!</p></li>
<li><p>Alpha is all you want and all you need. So everyone is chasing it</p></li>
<li><p>So you expect that alpha of an asset or a trading strategy should be very transient‚Äì it will quickly disappears as people learn about it</p></li>
<li><p>This will pose a challenge for you</p></li>
</ul>
</section>
<section id="how-do-you-find-alpha">
<h3><span class="section-number">8.8.2. </span>How do you find alpha?<a class="headerlink" href="#how-do-you-find-alpha" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Estimating Alpha is hard!</p></li>
<li><p>Every one in the business is searching for alpha</p></li>
<li><p>So true alpha is</p>
<ul>
<li><p>hard to find</p></li>
<li><p>disappears quickly</p></li>
<li><p>if the data was clear, people would already jumped at it</p></li>
<li><p>Once too much capital is in the trade we say that the trade is ‚Äúcrowded‚Äù</p></li>
<li><p>A crowded trade can yield NEGATIVE alpha, even if the original idea was right!</p></li>
<li><p>You have to be right, but also early.</p></li>
<li><p>If the trade gets crowded after you already in, is that good or bad? What do you do?</p></li>
<li><p>Can you be too early?</p></li>
</ul>
</li>
</ul>
</section>
<section id="if-not-estimation-then-what">
<h3><span class="section-number">8.8.3. </span>If not estimation then what?<a class="headerlink" href="#if-not-estimation-then-what" title="Link to this heading">#</a></h3>
<p>You need to think!</p>
<ul class="simple">
<li><p>Valuation. You understand a business/market and think the market is not seeing what you are seeing. IT can be short-term insight, like a big client will cancel their services, or long-term prospects for the company business.</p>
<ul>
<li><p>Warren Buffet whole stick is about this. Read his letters to shareholders. It is all about finding good firms at good value</p></li>
<li><p>David Einhorn is another example. He famously betted against Leahman Brothers.</p></li>
<li><p>Often this view will be formed by not only looking at balance sheets , but interacting with company insiders. Even though interactions are public, access allow a good fundamental analyst to see things more clearly (if you get private information, it is of course ‚Äúeasier‚Äù but it is illegal and you might end up in jail!)</p></li>
<li><p>Edge here is having good business judgment. You need to be confident that you are seeing something different form the market and you are right!</p></li>
<li><p>IT is good discipline to think why people are thinking the wrong thing‚Äìyou need to understand why the opportunity is there in the first place</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Liquidity provision</p>
<ul>
<li><p>When firms are downgraded some fund are forced to sell, this often creates reversals</p></li>
<li><p>Similar effect happens when a firm is dropped from an index, say SP500</p></li>
<li><p>And it happens in the opposite direction when it is added to the index</p></li>
<li><p>When mutual fund suffers outflows, they often have to sell, this often creates reversals are as well</p></li>
<li><p>The bet here is that you understand the reason these buy and sells are happening‚Äìand that they are not about fundamental news</p></li>
<li><p>So you bet the price movements triggered by them will ultimate revert, so you take the other side of the trade‚Äìi.e. provide liquidity (at a sweet premium of course)</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Data that other people don‚Äôt have.</p>
<ul>
<li><p>Famous example are satellite pictures of parking lots of retail stores‚Äìmight allow you to predict sales better which hopefully translates into predictions about prices once the market becomes aware of the sales</p></li>
<li><p>Flow data‚Äìthis is slightly different from liquidity provision‚Äìas you can front run buys/sells if you know that the flows are coming and that they will move markets</p></li>
<li><p>flooding data, exposure to temperature,</p></li>
<li><p>supplier data</p></li>
<li><p>See below a diagram by JP Morgan illustrating the variety of data sources</p></li>
</ul>
</li>
</ul>
<p><img alt="Alternative Data" src="https://github.com/amoreira2/Fin418/blob/main/assets/plots/alternativedata.png?raw=1" /></p>
</section>
<section id="alpha-quantification-procedure">
<h3><span class="section-number">8.8.4. </span>Alpha Quantification Procedure<a class="headerlink" href="#alpha-quantification-procedure" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Regardless how you get to you alpha, in the end you have to put your trading insights in the same playing field</p></li>
<li><p>Need to choose an horizon, say a month, and put all your alpha in that frequency.</p></li>
</ul>
<p>Example:</p>
<ul class="simple">
<li><p>Say you have a theory that NVDIA currently trading at 1000 will be at 800 in one year due to things that entirely specific to NVDIA (that is a -20% return)</p></li>
<li><p>Suppose you do not have a theory of when exactly that will happen</p></li>
<li><p>Then you alpha for next month is <span class="math notranslate nohighlight">\((0.8)^{(1/12)}-1\approx-1.8\%\)</span></p></li>
<li><p>Now suppose you know the timing‚Äìso you know this  bad news is likely to come only on the last two earnings of the year, then you alpha=0 for the first six months of the year and <span class="math notranslate nohighlight">\((0.8)^{(1/6)}-1\approx-3.6\%\)</span> for last six months of the year</p></li>
</ul>
</section>
<section id="real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors">
<h3><span class="section-number">8.8.5. </span>Real Alpha is unique and cannot be driven by broad macro factors<a class="headerlink" href="#real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>It is useful to develop views for a range of firms/ industries to check that you are not implicitly making a market-wide bet</p></li>
<li><p>if that is your bet, it is silly to hedge market risk‚Äìand it is very inefficient  to buy a single stock to trade this view</p></li>
<li><p>You should just buy the market in this case!</p></li>
<li><p>And it is important to be aware because it is much harder to be right!</p></li>
<li><p>In practice the notion of ‚Äúbroad macro factors‚Äù is much broader then market beta and will often include exposure to a variety of factors, including industry factors</p></li>
<li><p>While it is ok to make a bet on an industry, it is important to know exactly what your trade is</p></li>
<li><p>Buying NVDIA because your bullish on the tech sector is not efficient‚Äìyou should buy the whole tech sector in that case‚Äìmuch less risk per unit of exposure- as it is not exposed to NVDIA specific factors?</p></li>
</ul>
</section>
</section>
<section id="key-takeaways">
<h2><span class="section-number">8.9. </span>üìù Key Takeaways<a class="headerlink" href="#key-takeaways" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Betas, variances, and even risk-premia can be estimated with historical data, although we varying look-back windows</p></li>
<li><p>Standard errors can be deceiving</p></li>
<li><p>Alphas are different</p></li>
<li><p>Converting a one-year price target into a monthly alpha ensures consistent sizing and portfolio aggregation.</p></li>
<li><p>Understand where your edge comes from</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="extra-material-the-normal-distribution">
<h2><span class="section-number">8.10. </span>Extra Material: The Normal distribution<a class="headerlink" href="#extra-material-the-normal-distribution" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Most of what we do does not depend on the assumption of normality</p></li>
<li><p>But normal distributions are very useful in statistical tests</p></li>
<li><p>And they are also not a bad approximation for return data at low frequency (monthly/year)</p></li>
<li><p>Probability that any random draw form a Normal distribution random variable <span class="math notranslate nohighlight">\(\tilde{x}\)</span> is within <span class="math notranslate nohighlight">\(n=1\)</span> standard deviation from the mean is 0.6826</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Prob(E[\tilde{x}]-1\sigma(\tilde{x})\leq \tilde{x}\leq E[\tilde{x}]+1\sigma(\tilde{x}))=0.6826\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n=2,Prob(\cdot)=0.9550\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[Prob(E[\tilde{x}]-2\sigma(\tilde{x})\leq \tilde{x}\leq E[\tilde{x}]+2\sigma(\tilde{x}))=0.9550\]</div>
<ul class="simple">
<li><p>it is convenient to to transform a normally distributed r.v. into units of standard deviations from it‚Äôs mean</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\tilde{z}=\frac{\tilde{x}-E[\tilde{x}]}{\sigma(\tilde{x})}\]</div>
<ul class="simple">
<li><p>This follows the ‚Äústandard‚Äù normal distribution, which has mean 0 and and standard deviation 1</p></li>
<li><p>can you show that is indeed the case that z has mean zero and standard devaiton 1?</p></li>
<li><p>This means that the normal distribution is completely characterized by it‚Äôs first two moments</p></li>
<li><p>This means that the investment problem is much more tractable too!</p></li>
<li><p>Only two moments to worry about:</p>
<ul>
<li><p>The expected return of the portfolio</p></li>
<li><p>it‚Äôs variance</p></li>
<li><p>The probability of really bad tail events will follow immediately from these two!</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>

<span class="c1">#quantile function</span>
<span class="n">x</span><span class="o">=</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.95</span><span class="p">))</span>
<span class="c1"># cdf</span>
<span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CapitalAllocationI.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Capital Allocation</p>
      </div>
    </a>
    <a class="right-next"
       href="Timing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Timing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libraries-and-auxiliary-functions">8.1. Libraries and Auxiliary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-model-recap">8.2. Factor Model recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-estimation-problem-that-we-need-to-solve">8.3. What is the estimation problem that we need to solve?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#betas-factor-loadings">8.4. Betas (Factor Loadings)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#our-data">8.4.1. Our Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-estimate-betas">8.4.2. How do we estimate betas?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is-this-too-good-to-be-true">8.4.3. Is this too Good to be true?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#betas-over-time">8.4.4. Betas over time</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-function-definition">8.4.4.1. üêç Note: function definition</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-groupby">8.4.4.2. üêç Note: Groupby</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty">8.4.5. Uncertainty</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-anonymous-function-lambda">8.4.5.1. üêç Note : Anonymous Function (lambda)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals">8.4.5.2. Confidence Intervals</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-question-these-standard-errors-confidence-intervals-answer">8.4.5.3. What question these standard errors/confidence intervals answer?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#it-is-a-forecasting-problem">8.4.5.4. It is a Forecasting Problem!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential-decay-models">8.4.6. Exponential decay models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variances">8.5. Variances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variances-over-time">8.5.1. Variances Over time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-rolling-method">8.5.2. üêç Note : Rolling method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nobel-insight">8.5.3. Nobel insight</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#realized-variance">8.5.4. Realized Variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-realized-variance">8.5.5. Forecasting Realized Variance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forecasting-with-market-views">8.5.6. Forecasting with market views</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#idiosyncratic-volatility">8.5.7. Idiosyncratic  Volatility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#question-g3">8.5.8. ‚ö° ‚è∞ Question: G3 ‚ö°</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-section-vs-time-series">8.6. Cross-Section vs Time-series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-returns">8.7. Expected returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-risk-premia">8.7.1. Factor Risk-Premia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-sizes-and-learning-about-means">8.7.2. Sample sizes and learning about means</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detecting-time-variation-in-means">8.7.3. Detecting time-variation in means</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-is-all-you-need">8.8. Alpha is all you need</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-stacked-data-sets">8.8.1. üêç Note : Stacked data sets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-you-find-alpha">8.8.2. How do you find alpha?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-not-estimation-then-what">8.8.3. If not estimation then what?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-quantification-procedure">8.8.4. Alpha Quantification Procedure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-alpha-is-unique-and-cannot-be-driven-by-broad-macro-factors">8.8.5. Real Alpha is unique and cannot be driven by broad macro factors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">8.9. üìù Key Takeaways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-material-the-normal-distribution">8.10. Extra Material: The Normal distribution</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>