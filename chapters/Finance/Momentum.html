
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>10.18. Momentum &#8212; Data Driven Investing with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/Momentum';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/Momentum.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10.19. What Are Factors?" href="Factors.html" />
    <link rel="prev" title="10. Cross-Sectional Trading strategies" href="crosssectionalequitystrategies.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Data Driven Investing with Python - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Data Driven Investing with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.5. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.6. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.12. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModelEstimation.html">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">9.2. üìà Volatility Timing: Boosting Sharpe Ratios! üöÄ</a></li>

</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">10.18. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.19. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">14.7. üìä Interpreting Factor Models</a></li>



</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="RiskManagement.html">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingCosts.html">16. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">17. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLMs.html">18. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">19. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">20. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">20.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/Momentum.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/Momentum.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/Momentum.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Momentum</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#signal-construction">10.18.1. Signal Construction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libraries-and-all-that">10.18.2. Libraries and all that</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-return-and-market-cap-data-by-firm-date">10.18.2.1. Load return and market cap data by firm/date</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-rolling-cumulate-the-returns">10.18.2.2. Construct rolling  cumulate the returns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-signal-with-returns">10.18.2.3. Merge Signal with returns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-timing-right">10.18.2.4. Get the timing right</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#portfolio-formation">10.18.3. Portfolio formation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-all-in-a-function-that-goes-from-the-return-market-cap-data-to-the-final-signal-sorted-portfolio">10.18.4. Wrapping all in a function that goes from the Return/market cap data to the final signal-sorted portfolio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#return-based-signals-a-summary">10.18.5. Return-Based Signals: a summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-might-work">10.18.6. Why this might work?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-returns-based-strategies">10.18.7. Other ‚Äúreturns‚Äù based strategies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">10.18.8. üìù Key Takeaways</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="momentum">
<h1><span class="section-number">10.18. </span>Momentum<a class="headerlink" href="#momentum" title="Link to this heading">#</a></h1>
<p><strong>Momentum</strong> is the fact that stocks that have performed
<strong>relatively</strong> well in the past continue to perform
<strong>relatively</strong> well in the future, and stocks that have performed
<strong>relatively</strong> poorly, continue to perform <strong>relatively</strong>
poorly.</p>
<p>A Momentum investment or ‚Äúrelative strength‚Äù
strategy buys stocks which have performed relatively
well in the past and sells (shorts) stocks which have performed
relatively poorly.
Over the <strong>1963-1990</strong> time period, Jegadeesh and Titman
(1993) found that a strategy that ranked stocks based on
their past 6 months to a year returns, and bought the top
10% and shorted the bottom 10% based on this ranking,
produced abnormal returns of 12% per year.</p>
<p>Momentum portfolios bet on <strong>cross-sectional</strong> continuation. That is, in a stock did well relative to others in the recent past, the bet is that will continue to do better than the average going forward.</p>
<p>In some ways momentum is the opposite of a value strategy , since value stocks are stocks that have had very low returns (how else they would be value?)</p>
<p>The difference is that value/growth focus on the valuation ratio as the signal of how low the price is. So the valuation ratio captures the entire history of returns (what is price if not the result of the historical returns). Momentum instead focus on the last 12 months. Recent, but not too recent. But there many versions of Momentum.</p>
<section id="signal-construction">
<h2><span class="section-number">10.18.1. </span>Signal Construction<a class="headerlink" href="#signal-construction" title="Link to this heading">#</a></h2>
<p>We have build portfolios using pre-constructed signals.</p>
<p>These signals are well known and therefore made them an unlikely source of large Sharpe ratios.</p>
<p>A quant fund aims to construct new characteristics based on new data or new ideas of how to combine the relevant public information.</p>
<p>So signal construction is ART and not science. There is no recipe here and each signal is constructed differently.</p>
<blockquote>
<div><p>We will have an overview of the main factors used in the industry‚Äìhold tight!</p>
</div></blockquote>
<p>Now our goal is to learn one particular technique of factor construction that is based on past returns.</p>
<p>I like to over this one because it enable you to do many different variations as we will see.</p>
</section>
<section id="libraries-and-all-that">
<h2><span class="section-number">10.18.2. </span>Libraries and all that<a class="headerlink" href="#libraries-and-all-that" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.offsets</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Construction</strong></p>
<p>Here is how Daniel and Moskowitz construct their portfolios</p>
<blockquote>
<div><p>To form the momentum portfolios, <strong>we first rank stocks based on their cumulative returns
from 12 months before to one month before the formation date (i.e., the t-12 to t-2-month
returns)</strong>, we use a one month gap between the end of the ranking period and
the start of the holding period <strong>to avoid the short-term reversals</strong> documented by Jegadeesh
(1990) and Lehmann (1990). In particular we will focus on 10% and 90% quantiles of the signal distribution and will construct portfolios of all stocks that are in the bottom and top quintiles</p>
</div></blockquote>
<ol class="arabic simple">
<li><p>Get monthly returns and market equity data for all us firms</p></li>
<li><p>Compute rolling cumulative 11 month returns</p></li>
<li><p>Lag signal by one month because rolling average includes current month.</p>
<ul class="simple">
<li><p>This makes the signal cumulative returns form t-11 to t-1</p></li>
<li><p>It is a valid signal to bu at closing price of date t-1 to earn date t returns</p></li>
<li><p>But that is not yet what we want</p></li>
</ul>
</li>
<li><p>Lag another month to be consistent with the  t-12 to t-2 month construction</p></li>
<li><p>Groups stocks according to this signal</p></li>
<li><p>Form portfolios</p></li>
</ol>
<section id="load-return-and-market-cap-data-by-firm-date">
<h3><span class="section-number">10.18.2.1. </span>Load return and market cap data by firm/date<a class="headerlink" href="#load-return-and-market-cap-data-by-firm-date" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/amoreira2/UG54/blob/main/assets/data/crspm2002_2024.pkl?raw=true&quot;</span>
<span class="n">crsp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>


<span class="c1"># construction of market equity</span>
<span class="n">crsp</span><span class="o">=</span><span class="n">crsp</span><span class="p">[[</span><span class="s1">&#39;permco&#39;</span><span class="p">,</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;ret&#39;</span><span class="p">,</span><span class="s1">&#39;shrout&#39;</span><span class="p">,</span><span class="s1">&#39;prc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># change variable format to int</span>
<span class="n">crsp</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">]]</span><span class="o">=</span><span class="n">crsp</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">crsp</span><span class="p">[[</span><span class="s1">&#39;permco&#39;</span><span class="p">]]</span><span class="o">=</span><span class="n">crsp</span><span class="p">[[</span><span class="s1">&#39;permco&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># Line up date to be end of month</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># calculate market equity</span>
<span class="c1"># why do we use absolute value of price?</span>
<span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">*</span><span class="n">crsp</span><span class="p">[</span><span class="s1">&#39;shrout&#39;</span><span class="p">]</span>
<span class="c1"># drop price and shareoustandng since we won&#39;t need it anymore</span>
<span class="n">crsp</span><span class="o">=</span><span class="n">crsp</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;prc&#39;</span><span class="p">,</span><span class="s1">&#39;shrout&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">crsp_me</span><span class="o">=</span><span class="n">crsp</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permco&#39;</span><span class="p">])[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1"># largest mktcap within a permco/date</span>
<span class="n">crsp_maxme</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permco&#39;</span><span class="p">])[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1"># join by jdate/maxme to find the permno</span>
<span class="n">crsp</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">crsp</span><span class="p">,</span> <span class="n">crsp_maxme</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permco&#39;</span><span class="p">,</span><span class="s1">&#39;me&#39;</span><span class="p">])</span>
<span class="c1"># drop me column and replace with the sum me</span>
<span class="n">crsp</span><span class="o">=</span><span class="n">crsp</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;me&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># join with sum of me to get the correct market cap info</span>
<span class="n">crsp</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">crsp</span><span class="p">,</span> <span class="n">crsp_me</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permco&#39;</span><span class="p">])</span>
<span class="c1"># sort by permno and date and also drop duplicates</span>
<span class="n">crsp</span><span class="o">=</span><span class="n">crsp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">crsp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>permco</th>
      <th>permno</th>
      <th>ticker</th>
      <th>date</th>
      <th>ret</th>
      <th>me</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>212</th>
      <td>7953</td>
      <td>10001</td>
      <td>EWST</td>
      <td>2002-01-31</td>
      <td>-0.013100</td>
      <td>28995.8000</td>
    </tr>
    <tr>
      <th>213</th>
      <td>7953</td>
      <td>10001</td>
      <td>EWST</td>
      <td>2002-02-28</td>
      <td>-0.053097</td>
      <td>27488.3000</td>
    </tr>
    <tr>
      <th>214</th>
      <td>7953</td>
      <td>10001</td>
      <td>EWST</td>
      <td>2002-03-31</td>
      <td>-0.015888</td>
      <td>26738.4000</td>
    </tr>
    <tr>
      <th>215</th>
      <td>7953</td>
      <td>10001</td>
      <td>EWST</td>
      <td>2002-04-30</td>
      <td>-0.043269</td>
      <td>25581.4500</td>
    </tr>
    <tr>
      <th>216</th>
      <td>7953</td>
      <td>10001</td>
      <td>EWST</td>
      <td>2002-05-31</td>
      <td>0.014824</td>
      <td>25960.6725</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="construct-rolling-cumulate-the-returns">
<h3><span class="section-number">10.18.2.2. </span>Construct rolling  cumulate the returns<a class="headerlink" href="#construct-rolling-cumulate-the-returns" title="Link to this heading">#</a></h3>
<p>We need to construct the returns from t-11 to t:</p>
<div class="math notranslate nohighlight">
\[1+r_{t-11,t}=(1+r_{t-11})(1+r_{t-10})..(1+r_{t-1})(1+r_{t})\]</div>
<p>We will now cumulate the returns of <strong>each asset</strong> on a rolling basis. As described in the procedure we wll look back for 11 months and compute the cumulative return in the period.</p>
<p>‚ö° ‚è∞ Question: Group A-C ‚ö°</p>
<ul class="simple">
<li><p>Complete the text and the code</p></li>
</ul>
<blockquote>
<div><p><strong>TIP</strong> We will be grouping by ________ and applying the <code class="docutils literal notranslate"><span class="pre">rolling()</span></code> operator, we will them apply the function ________ to obtain the cumulative return of the asset in the window. The _____ is what makes the rolling to be applied firm by firm.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">crsp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;1+ret&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">temp</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">__</span><span class="p">)[[</span><span class="s1">&#39;1+ret&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">__</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">__</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">temp</span><span class="o">=</span><span class="n">temp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1+ret&#39;</span><span class="p">:</span><span class="s1">&#39;cumret11&#39;</span><span class="p">})</span>
<span class="n">temp</span> <span class="o">=</span><span class="n">temp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">temp</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>permno</th>
      <th>date</th>
      <th>cumret11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1130765</th>
      <td>93436</td>
      <td>2024-08-31</td>
      <td>0.855687</td>
    </tr>
    <tr>
      <th>1130766</th>
      <td>93436</td>
      <td>2024-09-30</td>
      <td>1.302678</td>
    </tr>
    <tr>
      <th>1130767</th>
      <td>93436</td>
      <td>2024-10-31</td>
      <td>1.040695</td>
    </tr>
    <tr>
      <th>1130768</th>
      <td>93436</td>
      <td>2024-11-30</td>
      <td>1.389087</td>
    </tr>
    <tr>
      <th>1130769</th>
      <td>93436</td>
      <td>2024-12-31</td>
      <td>2.156229</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="merge-signal-with-returns">
<h3><span class="section-number">10.18.2.3. </span>Merge Signal with returns<a class="headerlink" href="#merge-signal-with-returns" title="Link to this heading">#</a></h3>
<p>We now merge back this <code class="docutils literal notranslate"><span class="pre">cumret11</span></code> variable with our data set</p>
<ul class="simple">
<li><p>Reset the <code class="docutils literal notranslate"><span class="pre">df</span></code> index so both <code class="docutils literal notranslate"><span class="pre">permno</span></code> and <code class="docutils literal notranslate"><span class="pre">date</span></code> are normal columns.</p></li>
<li><p>This makes the merge easier</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">temp</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;cumret11&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-the-timing-right">
<h3><span class="section-number">10.18.2.4. </span>Get the timing right<a class="headerlink" href="#get-the-timing-right" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The first month to make sure the signal is tradable, so that is mandatory to make this a valid strategy without look-ahead bias</p></li>
<li><p>We do an additional month, so lag by 2, because we will be skipping a month between the last return data used in the signal and the time we buy the stock</p></li>
<li><p>so we cumulate returns up to t-2, and form the portfolio in beginning of month t, so return t-1 does not go either in the signal or in our strategy</p>
<ul>
<li><p>For example, for the portfolio formed in the last day of december-2024 and held till the last day of january-2025, our signal is the cumulative return from the last day of december-2023 till the last day of november-2024.</p></li>
<li><p>So the returns for the month of december-2024 are skipped and not used in the signal construction</p></li>
<li><p>Before lagging it always important to sort the values so the result is what you intended</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permno&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mom&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)[</span><span class="s1">&#39;cumret11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># why I am groupby permno here befroe lagging?</span>
<span class="c1"># drop the row if any of &#39;mom&#39; is missing</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mom&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;1+ret&#39;</span><span class="p">,</span><span class="s1">&#39;cumret11&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># lag market cap</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;me_l1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>permco</th>
      <th>permno</th>
      <th>ticker</th>
      <th>ret</th>
      <th>me</th>
      <th>mom</th>
      <th>me_l1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1128354</th>
      <td>2024-12-31</td>
      <td>53407</td>
      <td>93374</td>
      <td>FAF</td>
      <td>-0.102210</td>
      <td>6.431570e+06</td>
      <td>1.114413</td>
      <td>7.225731e+06</td>
    </tr>
    <tr>
      <th>1129015</th>
      <td>2024-12-31</td>
      <td>53423</td>
      <td>93397</td>
      <td>LMNR</td>
      <td>-0.117446</td>
      <td>4.410872e+05</td>
      <td>1.710240</td>
      <td>5.013174e+05</td>
    </tr>
    <tr>
      <th>1130094</th>
      <td>2024-12-31</td>
      <td>53443</td>
      <td>93426</td>
      <td>VPG</td>
      <td>0.021768</td>
      <td>2.867095e+05</td>
      <td>0.761234</td>
      <td>2.806015e+05</td>
    </tr>
    <tr>
      <th>1130571</th>
      <td>2024-12-31</td>
      <td>53427</td>
      <td>93434</td>
      <td>SANW</td>
      <td>0.133333</td>
      <td>1.824916e+04</td>
      <td>0.184251</td>
      <td>1.610220e+04</td>
    </tr>
    <tr>
      <th>1130769</th>
      <td>2024-12-31</td>
      <td>53453</td>
      <td>93436</td>
      <td>TSLA</td>
      <td>0.170008</td>
      <td>1.296351e+09</td>
      <td>1.040695</td>
      <td>1.107984e+09</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="portfolio-formation">
<h2><span class="section-number">10.18.3. </span>Portfolio formation<a class="headerlink" href="#portfolio-formation" title="Link to this heading">#</a></h2>
<p>We can now simply use the function we just build to construct characteristic-based portfolios</p>
<p>Just make sure that our labels here are consistent with what we had before</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">returnbyX</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">ngroups</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X_group&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="n">X</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ngroups</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">duplicates</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">))</span>
    <span class="n">ret</span> <span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;X_group&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;me_l1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;me_l1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="n">ret</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">==</span><span class="s1">&#39;ret&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">ret</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="n">returnbyX</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="s1">&#39;mom&#39;</span><span class="p">,</span><span class="n">ngroups</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Alan.Moreira\AppData\Local\Temp\ipykernel_45468\3636907694.py:3: RuntimeWarning: invalid value encountered in scalar divide
  ret =df.groupby([&#39;date&#39;,&#39;X_group&#39;]).apply(lambda x:(x[y]*x[&#39;me_l1&#39;]).sum()/x[&#39;me_l1&#39;].sum())
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>X_group</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2002-09-30</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2002-10-31</th>
      <td>0.209799</td>
      <td>0.158546</td>
      <td>0.184425</td>
      <td>0.124120</td>
      <td>0.081724</td>
      <td>0.055959</td>
      <td>0.045086</td>
      <td>0.036194</td>
      <td>0.004343</td>
      <td>-0.010977</td>
    </tr>
    <tr>
      <th>2002-11-30</th>
      <td>0.424524</td>
      <td>0.203033</td>
      <td>0.146892</td>
      <td>0.105215</td>
      <td>0.060791</td>
      <td>0.025019</td>
      <td>0.006972</td>
      <td>-0.009587</td>
      <td>-0.038439</td>
      <td>0.003013</td>
    </tr>
    <tr>
      <th>2002-12-31</th>
      <td>-0.164175</td>
      <td>-0.129545</td>
      <td>-0.142777</td>
      <td>-0.089586</td>
      <td>-0.074502</td>
      <td>-0.020326</td>
      <td>-0.031922</td>
      <td>-0.007599</td>
      <td>-0.002252</td>
      <td>-0.023626</td>
    </tr>
    <tr>
      <th>2003-01-31</th>
      <td>0.009969</td>
      <td>-0.033177</td>
      <td>-0.012791</td>
      <td>-0.036224</td>
      <td>-0.029866</td>
      <td>-0.028075</td>
      <td>-0.027832</td>
      <td>-0.015244</td>
      <td>-0.004285</td>
      <td>-0.015818</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-08-31</th>
      <td>-0.120313</td>
      <td>-0.031392</td>
      <td>0.001111</td>
      <td>-0.024248</td>
      <td>0.012486</td>
      <td>0.009185</td>
      <td>0.031679</td>
      <td>0.034088</td>
      <td>0.007724</td>
      <td>0.045985</td>
    </tr>
    <tr>
      <th>2024-09-30</th>
      <td>0.023907</td>
      <td>0.049337</td>
      <td>0.013426</td>
      <td>0.052623</td>
      <td>0.006125</td>
      <td>0.014734</td>
      <td>0.019235</td>
      <td>0.025015</td>
      <td>0.003189</td>
      <td>0.043364</td>
    </tr>
    <tr>
      <th>2024-10-31</th>
      <td>-0.046328</td>
      <td>-0.021620</td>
      <td>-0.029084</td>
      <td>-0.014452</td>
      <td>-0.019741</td>
      <td>-0.017264</td>
      <td>-0.020819</td>
      <td>-0.000511</td>
      <td>0.005709</td>
      <td>0.032563</td>
    </tr>
    <tr>
      <th>2024-11-30</th>
      <td>0.082092</td>
      <td>0.110147</td>
      <td>0.093987</td>
      <td>0.066592</td>
      <td>0.058021</td>
      <td>0.083176</td>
      <td>0.053043</td>
      <td>0.073858</td>
      <td>0.074791</td>
      <td>0.075265</td>
    </tr>
    <tr>
      <th>2024-12-31</th>
      <td>0.001590</td>
      <td>-0.027492</td>
      <td>-0.079237</td>
      <td>-0.069759</td>
      <td>-0.021428</td>
      <td>-0.016910</td>
      <td>-0.007464</td>
      <td>-0.062759</td>
      <td>-0.047893</td>
      <td>0.006328</td>
    </tr>
  </tbody>
</table>
<p>268 rows √ó 10 columns</p>
</div></div><img alt="../../_images/47a78110bb11101388297184eeeebad45b29191343576375edb68de258e00b89.png" src="../../_images/47a78110bb11101388297184eeeebad45b29191343576375edb68de258e00b89.png" />
</div>
</div>
</section>
<section id="wrapping-all-in-a-function-that-goes-from-the-return-market-cap-data-to-the-final-signal-sorted-portfolio">
<h2><span class="section-number">10.18.4. </span>Wrapping all in a function that goes from the Return/market cap data to the final signal-sorted portfolio<a class="headerlink" href="#wrapping-all-in-a-function-that-goes-from-the-return-market-cap-data-to-the-final-signal-sorted-portfolio" title="Link to this heading">#</a></h2>
<p>Things to try</p>
<ul class="simple">
<li><p>Play with different look-back windows</p></li>
<li><p>Play with how many months to skip (1 is the minimum to make the strategy valid. 2 is the standard.)
- What do you think it will happen if you don‚Äôt skip and let the signal overlap with the return data?
- What happens if you skip more months?</p></li>
<li><p>What happens if you sort only on the month that the standard momentum skips?</p></li>
<li><p>what if you sort on very long-term momentum, like 60 months?</p></li>
<li><p>Cumulative returns is just one possible moment to look at</p>
<ul>
<li><p>What about volatility?</p></li>
<li><p>What about covariance with the market?</p></li>
<li><p>What about maximum/minimum return?</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># put it all together in a fuction</span>
<span class="k">def</span><span class="w"> </span><span class="nf">momentum</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">ngroups</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lookback</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">extraskip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;1+ret&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">temp</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)[[</span><span class="s1">&#39;1+ret&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">lookback</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="n">lookback</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">temp</span><span class="o">=</span><span class="n">temp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1+ret&#39;</span><span class="p">:</span><span class="s1">&#39;signal_contemp&#39;</span><span class="p">})</span>
    <span class="n">temp</span> <span class="o">=</span><span class="n">temp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">temp</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;signal_contemp&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permno&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;me_l1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)[</span><span class="s1">&#39;me&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)[</span><span class="s1">&#39;signal_contemp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">extraskip</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
    <span class="n">ret</span><span class="o">=</span><span class="n">returnbyX</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">,</span><span class="n">ngroups</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">momentum</span><span class="p">(</span><span class="n">crsp</span><span class="p">,</span><span class="n">ngroups</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lookback</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">extraskip</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>X_group</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2003-01-31</th>
      <td>0.009158</td>
      <td>-0.033513</td>
      <td>-0.012609</td>
      <td>-0.035892</td>
      <td>-0.030035</td>
      <td>-0.028069</td>
      <td>-0.027867</td>
      <td>-0.015245</td>
      <td>-0.004282</td>
      <td>-0.015345</td>
    </tr>
    <tr>
      <th>2003-02-28</th>
      <td>-0.050593</td>
      <td>0.016807</td>
      <td>-0.014006</td>
      <td>-0.019663</td>
      <td>-0.027808</td>
      <td>-0.013673</td>
      <td>-0.019918</td>
      <td>-0.019084</td>
      <td>-0.011432</td>
      <td>0.006978</td>
    </tr>
    <tr>
      <th>2003-03-31</th>
      <td>0.055390</td>
      <td>-0.013165</td>
      <td>0.005488</td>
      <td>-0.009718</td>
      <td>0.022451</td>
      <td>0.018792</td>
      <td>0.010307</td>
      <td>0.009793</td>
      <td>0.027086</td>
      <td>0.034779</td>
    </tr>
    <tr>
      <th>2003-04-30</th>
      <td>0.222184</td>
      <td>0.159312</td>
      <td>0.159679</td>
      <td>0.132757</td>
      <td>0.083171</td>
      <td>0.060253</td>
      <td>0.054827</td>
      <td>0.056334</td>
      <td>0.034029</td>
      <td>0.073473</td>
    </tr>
    <tr>
      <th>2003-05-31</th>
      <td>0.214208</td>
      <td>0.189297</td>
      <td>0.134637</td>
      <td>0.096022</td>
      <td>0.073724</td>
      <td>0.043873</td>
      <td>0.026037</td>
      <td>0.047442</td>
      <td>0.061743</td>
      <td>0.090643</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-08-31</th>
      <td>-0.121623</td>
      <td>-0.032603</td>
      <td>0.001479</td>
      <td>-0.024347</td>
      <td>0.012539</td>
      <td>0.010668</td>
      <td>0.031008</td>
      <td>0.034119</td>
      <td>0.007720</td>
      <td>0.045979</td>
    </tr>
    <tr>
      <th>2024-09-30</th>
      <td>0.019904</td>
      <td>0.050513</td>
      <td>0.014613</td>
      <td>0.052698</td>
      <td>0.006031</td>
      <td>0.014736</td>
      <td>0.019235</td>
      <td>0.025015</td>
      <td>0.003221</td>
      <td>0.043354</td>
    </tr>
    <tr>
      <th>2024-10-31</th>
      <td>-0.044786</td>
      <td>-0.020529</td>
      <td>-0.030179</td>
      <td>-0.014448</td>
      <td>-0.019646</td>
      <td>-0.017093</td>
      <td>-0.020829</td>
      <td>-0.000529</td>
      <td>0.005618</td>
      <td>0.032594</td>
    </tr>
    <tr>
      <th>2024-11-30</th>
      <td>0.092213</td>
      <td>0.109820</td>
      <td>0.092730</td>
      <td>0.064826</td>
      <td>0.058672</td>
      <td>0.083389</td>
      <td>0.052749</td>
      <td>0.074340</td>
      <td>0.074962</td>
      <td>0.075089</td>
    </tr>
    <tr>
      <th>2024-12-31</th>
      <td>0.004509</td>
      <td>-0.027252</td>
      <td>-0.080408</td>
      <td>-0.068744</td>
      <td>-0.021532</td>
      <td>-0.016844</td>
      <td>-0.007563</td>
      <td>-0.062828</td>
      <td>-0.047753</td>
      <td>0.006330</td>
    </tr>
  </tbody>
</table>
<p>264 rows √ó 10 columns</p>
</div></div><img alt="../../_images/0030429c070d3fe9d823add51ec13fbd240b538cfc77acc0c4ccbe3e5bf9f5e6.png" src="../../_images/0030429c070d3fe9d823add51ec13fbd240b538cfc77acc0c4ccbe3e5bf9f5e6.png" />
</div>
</div>
</section>
<section id="return-based-signals-a-summary">
<h2><span class="section-number">10.18.5. </span>Return-Based Signals: a summary<a class="headerlink" href="#return-based-signals-a-summary" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Long-term reversals</p>
<ul class="simple">
<li><p>DeBondt and Thaler (1985)</p></li>
<li><p>3-5 year contrarian strategy</p></li>
</ul>
</li>
<li><p>Short-term (&lt; 1 month) reversals</p>
<ul class="simple">
<li><p>Jegadeesh (1990), Lehman (1990), Lo andMacKinlay (1988)</p></li>
</ul>
</li>
<li><p>Intermediate horizon continuation</p>
<ul class="simple">
<li><p>Jegadeesh and Titman (1993)</p></li>
<li><p>3-12 month momentum strategy</p></li>
<li><p>profits dissipate over 1-year and start to reverse after 2-3 years -&gt; temporary price effect.</p></li>
<li><p>see similar pattern around earnings announcements (both earnings and price momentum).</p></li>
</ul>
</li>
</ol>
</section>
<section id="why-this-might-work">
<h2><span class="section-number">10.18.6. </span>Why this might work?<a class="headerlink" href="#why-this-might-work" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Behavioral view: The idea here is that markets might be slow to incorporate information, so good/bad news gets into prices slowly over time. For example investors might only slowly get into prices the consequences of a Trump second term.</p></li>
<li><p>Rational view: Maybe all these stocks are exposed to the same missing risk-factor. They all went up and down at the same time after all! For example all firms that went down in march 2020 are particularly exposed to Covid and the ones that did well are positively exposed. So they will move together as COVID risk fluctuate. It is hard to use a story like that to explain the premium, but it is easy to see how it explains the co-movement.</p></li>
<li><p>My overall sense is that the majority of academics think that momentum is driven by ‚Äúbehavioral‚Äù factors. Note however that momentum tends to crash very badly in high volatility periods such as 2008 and 2020, so it is certainly risky if you zoom out a bit.</p></li>
</ul>
<p><strong>Literature</strong></p>
<p>Lots of work on this.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://www.annualreviews.org/doi/full/10.1146/annurev-financial-102710-144850">Here is a review of the work on the momentum strategy</a></p></li>
<li><p><a class="reference external" href="https://www.jstor.org/stable/pdf/2328882.pdf?casa_token=wjU0QYjZvg4AAAAA:aAxgJJLpR7VexgbmcWBBUMveRXin7d5VpGkrYIXDm_UseOs_ETYRZWSNLHzmkGrDFk5A4PNvA6nI8JY4k5khKlSDucppwJ1JNlx0GGqQthOQ4uBY6cA">Here is the paper that first documented the Momentum profitability</a></p></li>
<li><p><a class="reference external" href="https://github.com/amoreira2/Lectures/blob/a1f2e6ef36e80d32ee12a391b878f564f15c3cd5/assets/papers/Daniel%20Moskowitz%202015.pdf">Here is Daniel and Moskowitz analysis of momentum</a></p></li>
</ol>
</section>
<section id="other-returns-based-strategies">
<h2><span class="section-number">10.18.7. </span>Other ‚Äúreturns‚Äù based strategies<a class="headerlink" href="#other-returns-based-strategies" title="Link to this heading">#</a></h2>
<p>One can easily adapt the code to reproduce a variety of investment strategies that only rely on return information, broadly described as ‚Äútechnical‚Äù strategies</p>
<ol class="arabic simple">
<li><p>Short-term Reversals: Sort stocks based on returns in month t-1, but in the beginning of month t</p></li>
<li><p>Long-term reversals: Sort on cumulative returns of the last 5 years</p></li>
<li><p>Volatility: sort on the return volatility of the last 24 months, say using returns between t-24 to t-1 and form the portfolio in beginning of date t.</p></li>
<li><p>(HARDER) Market beta: Sort stocks based on their beta with the market portfolio. Say estimate beta using the last 60 months of data (t-60 to t-1) and form portfolio at the beginning of date t.</p></li>
</ol>
<p>Below is a plot that summarizes the empirical evidence on return-based strategies. It shows the Sharpe Ratio as a function of the lookback period of the return signal</p>
<p><img alt="image.png" src="https://github.com/amoreira2/Lectures/raw/main/assets/plots/momentum1.jpg" /></p>
<ul class="simple">
<li><p>Can you reproduce this plot?</p></li>
</ul>
<p>‚ö° ‚è∞ Question: Group D-G ‚ö°</p>
<ul class="simple">
<li><p>Building on a function above, create a for loop that reproduces this plot above.</p></li>
<li><p>Start by telling me what do you want to do</p></li>
<li><p>Then explain how you will get it done</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__</span><span class="o">=</span><span class="p">[]</span>
<span class="n">results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">__</span><span class="p">)</span>
<span class="k">for</span> <span class="n">__</span> <span class="ow">in</span> <span class="n">__</span><span class="p">:</span>
  <span class="n">ret</span><span class="o">=</span><span class="n">__</span>
  <span class="n">LS</span><span class="o">=</span><span class="n">__</span>
  <span class="n">results</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">=</span><span class="n">__</span>

<span class="n">results</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>‚ö° ‚è∞ Question: All groups ‚ö°</p>
<p>Modify the Momentum function to create a trading strategy that goes long the 10% stocks with lowest volatility in the previous 24 months and goes short the 10% stocks with the highest volatility in the previous 24 months</p>
</section>
<section id="key-takeaways">
<h2><span class="section-number">10.18.8. </span>üìù Key Takeaways<a class="headerlink" href="#key-takeaways" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Momentum</strong> is a trading strategy that exploits the tendency of past winning stocks to continue performing well and past losing stocks to continue performing poorly.</p></li>
<li><p>The standard momentum strategy involves ranking stocks based on their cumulative returns over the past 12 months (excluding the most recent month to avoid short-term reversals) and forming portfolios based on these rankings.</p></li>
<li><p>A key aspect of constructing a valid momentum signal is ensuring there is a time lag between the lookback period for calculating the signal and the holding period of the portfolio to avoid look-ahead bias.</p></li>
<li><p>Momentum strategies, while historically profitable, can experience significant drawdowns during periods of high market volatility.</p></li>
<li><p>Return-based strategies are not limited to momentum; other variations include short-term reversals, long-term reversals, and strategies based on volatility or market beta.</p></li>
<li><p>Constructing these strategies involves defining a signal based on past returns or other historical data, sorting stocks based on this signal, and forming portfolios (e.g., long-short portfolios of the top and bottom quantiles).</p></li>
<li><p>The empirical evidence suggests varying levels of profitability for different return-based strategies depending on the lookback period and other parameters.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="crosssectionalequitystrategies.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">10. </span>Cross-Sectional Trading strategies</p>
      </div>
    </a>
    <a class="right-next"
       href="Factors.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">10.19. </span>What Are Factors?</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#signal-construction">10.18.1. Signal Construction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libraries-and-all-that">10.18.2. Libraries and all that</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-return-and-market-cap-data-by-firm-date">10.18.2.1. Load return and market cap data by firm/date</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-rolling-cumulate-the-returns">10.18.2.2. Construct rolling  cumulate the returns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-signal-with-returns">10.18.2.3. Merge Signal with returns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-timing-right">10.18.2.4. Get the timing right</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#portfolio-formation">10.18.3. Portfolio formation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-all-in-a-function-that-goes-from-the-return-market-cap-data-to-the-final-signal-sorted-portfolio">10.18.4. Wrapping all in a function that goes from the Return/market cap data to the final signal-sorted portfolio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#return-based-signals-a-summary">10.18.5. Return-Based Signals: a summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-this-might-work">10.18.6. Why this might work?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-returns-based-strategies">10.18.7. Other ‚Äúreturns‚Äù based strategies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">10.18.8. üìù Key Takeaways</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>