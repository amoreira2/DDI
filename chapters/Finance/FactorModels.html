
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction to Factor models &#8212; Data Driven Investing with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/FactorModels';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/FactorModels.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Data Driven Investing with Python - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Data Driven Investing with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Data Driven Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns_c.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.11. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.12. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="Timing_c.html">5. Timing</a></li>

<li class="toctree-l1"><a class="reference internal" href="FactorModels_c.html">7. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath_c.html">8. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1_c.html">8.13. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">9. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModelEstimation.html">10. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">11. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">11.18. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">11.19. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">12. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">13. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">14. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">15. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">15.7. üìä Interpreting Factor Models</a></li>



</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="RiskManagement.html">16. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingCosts.html">17. Liquidity and Trading Cost Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">18. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="LLMs.html">19. Gen AI and LLMs in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">20. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">21. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">21.1. Assignment 1</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/FactorModels.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/FactorModels.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/FactorModels.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction to Factor models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libraries-and-auxiliary-functions">Libraries and Auxiliary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#towards-a-factor-model">Towards a Factor Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-models-vs-expected-returns-models">Risk Models vs Expected Returns Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-organization-of-wall-street-alpha-and-beta-s">The organization of Wall Street: Alpha and Beta(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-factor-exposure-to-risk-premia">From Factor Exposure to Risk Premia</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#focus-on-your-skill-hedge-all-the-residual-risk">Focus on your skill, hedge all the residual risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tacking-hedging-and-hedged-portfolios">Tacking, Hedging and Hedged portfolios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-and-risk-budgets">Factor Models and Risk Budgets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#try-it-out">üîß Try it out</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-your-expected-pnl-in-the-end-of-the-year">What is your <strong>expected</strong> PnL in the end of the year?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#focusing-on-your-edge">Focusing on your edge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-benefits-of-focusing-your-bets">The benefits of focusing your bets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharpe-ratio">Sharpe Ratio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appraisal-ratio">Appraisal Ratio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variance-decomposition">Variance Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">üìù Key Takeaways</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="introduction-to-factor-models">
<h1>Introduction to Factor models<a class="headerlink" href="#introduction-to-factor-models" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<p><strong>üéØ Learning Objectives</strong></p>
<p>By the end of this chapter, you should be able to:</p>
<ol class="arabic simple">
<li><p><strong>Decode the Œ± / Œ≤ decomposition.</strong><br />
Learn how any asset‚Äôs excess return can be split into a factor‚Äêdriven piece (Œ≤ √ó factor) and an asset-specific alpha, and see how this dual role lets factor models describe both risk and expected return.</p></li>
<li><p><strong>Estimate factor exposure and alpha with regression.</strong><br />
Use time-series regressions of excess returns on factor returns to obtain Œ≤, Œ±, residuals, and the associated statistics that guide portfolio design.</p></li>
<li><p><strong>Create tracking and hedged portfolios.</strong><br />
Build a <em>tracking</em> portfolio equal to Œ≤ times the factor, and a <em>hedged</em> (portable-alpha) portfolio that subtracts the tracking position‚Äîdelivering pure alpha with zero in-sample factor risk.</p></li>
<li><p><strong>Size positions under explicit risk budgets.</strong><br />
Apply volatility budgets at daily, monthly, or annual horizons; compute how much capital you can allocate to an unhedged position versus a hedged one, given its variance components.</p></li>
<li><p><strong>Appreciate the practical uses of factor models.</strong><br />
Understand why asset managers, pod shops, and risk desks rely on factor models to separate skill from beta, impose discipline on risk taking, and communicate performance.</p></li>
</ol>
<hr class="docutils" />
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Towards a Factor Model</p></li>
<li><p>Risk Models vs Expected Returns Models</p></li>
<li><p>Alpha and Beta(s)</p></li>
<li><p>Tracking, Hedging, and Hedged Portfolios</p></li>
<li><p>Factor Models and Risk Budgets</p></li>
<li><p>Sharpe Ratio</p></li>
<li><p>Appraisal Ratio</p></li>
<li><p>Variance Decomposition</p></li>
<li><p>Key Takeaways</p></li>
</ol>
</section>
<section id="libraries-and-auxiliary-functions">
<h2>Libraries and Auxiliary Functions<a class="headerlink" href="#libraries-and-auxiliary-functions" title="Link to this heading">#</a></h2>
<p>Libraries</p>
<ul class="simple">
<li><p>wrds: Connects to the Wharton Research Data Services (WRDS) database to access financial data.
= numpy: Provides support for large multi-dimensional arrays and matrices, along with a large collection of high-level mathematical functions to operate on these arrays.</p></li>
<li><p>pandas: Provides data structures (like DataFrames) and tools for data analysis and manipulation.</p></li>
<li><p>matplotlib.pyplot: A plotting library used for creating static, interactive, and animated visualizations in Python.</p></li>
<li><p>pandas_datareader.data: Allows fetching financial data from various internet sources.</p></li>
<li><p>datetime: Supplies classes for manipulating dates and times.</p></li>
</ul>
<p>Functions</p>
<ul class="simple">
<li><p>get_daily_wrds: Using wrds get daily stock market returns. It takes as input the connection and the list of tickers you want</p></li>
<li><p>get_factors: using the DataReader API it gets factors from Ken French website. If you don‚Äôt pass aythign it returns the risk-free rate and the market. If you pass ‚ÄúFF6=True‚Äù it returns 5 addional factors that we will discuss later in the class</p></li>
</ul>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Every time we start a new colab we need to install and import WRDS (if we are goign to use it)</span>
<span class="c1">## The way it works is that you click install and then an error is returned and you click &quot;RESTART&quot;</span>
<span class="c1">## Once you do that you can import it (i.e. run the next cell)</span>

<span class="c1">#%pip install wrds</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## for this to work you first need to install it</span>
<span class="c1">#import wrds</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load libraries</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataReader</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="c1"># define functions</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_daily_wrds</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">tickers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="c1"># Retrieve PERMNOs for the specified tickers</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">library</span><span class="o">=</span><span class="s1">&#39;crsp&#39;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;stocknames&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;namedt&#39;</span><span class="p">,</span> <span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">])</span>
    <span class="n">permnos</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tickers</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;nameenddt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>
    <span class="c1"># Extract unique PERMNOs</span>
    <span class="n">permno_list</span> <span class="o">=</span> <span class="n">permnos</span><span class="p">[</span><span class="s1">&#39;permno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># Query daily stock file for the specified PERMNOs</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT permno, date, ret, retx, prc</span>
<span class="s2">        FROM crsp.dsf</span>
<span class="s2">        WHERE permno IN (</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">permno_list</span><span class="p">))</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        ORDER BY date,permno</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">date_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">permnos</span><span class="p">[[</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="c1"># Pivot data to have dates as index and tickers as columns</span>
    <span class="n">daily_returns</span> <span class="o">=</span> <span class="n">daily_returns</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span>
    <span class="n">daily_returns</span><span class="o">=</span><span class="n">daily_returns</span><span class="p">[</span><span class="n">tickers</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">daily_returns</span>



<span class="k">def</span><span class="w"> </span><span class="nf">get_factors</span><span class="p">(</span><span class="n">ff6</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1926-01-01&quot;</span><span class="p">)</span>
    <span class="n">daily_data</span> <span class="o">=</span> <span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># The first DataFrame contains the daily data</span>
    <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Ensure index is datetime</span>
    <span class="k">if</span> <span class="n">ff6</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]]</span>  <span class="c1"># Extract the Risk-Free Rate (RF)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_factor</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;SMB&#39;</span><span class="p">,</span><span class="s1">&#39;HML&#39;</span><span class="p">,</span><span class="s1">&#39;RMW&#39;</span><span class="p">,</span><span class="s1">&#39;CMA&#39;</span><span class="p">]]</span>
        <span class="n">fama_french</span> <span class="o">=</span> <span class="n">DataReader</span><span class="p">(</span><span class="s2">&quot;F-F_Momentum_Factor_daily&quot;</span><span class="p">,</span> <span class="s2">&quot;famafrench&quot;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;1926-01-01&quot;</span><span class="p">)</span>
        <span class="n">df_factor</span><span class="o">=</span><span class="n">df_factor</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fama_french</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_factor</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="towards-a-factor-model">
<h2>Towards a Factor Model<a class="headerlink" href="#towards-a-factor-model" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>First idea is that stocks might have different degree of co-movement</p></li>
<li><p>For example, Defensive stocks like utilities, supermarkets, and so on might not suffer as much when the market tanks</p>
<ul>
<li><p>Their cash flow might be more recession proof for example</p></li>
<li><p>While luxury good producers like LMVH might be more sensitive to the stock market given its consumer base</p></li>
</ul>
</li>
<li><p>Small stocks, stocks with high leverage and so one might particularly suffer during economic busts</p></li>
</ul>
<div class="math notranslate nohighlight">
\[(excess~return)=(intercept)+(stock~beta)*(factor~excess~return)+ (idio~risk)\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># uncomment to dowload the data directly from WRDS and FRED</span>

<span class="c1">##############################################################################</span>
<span class="c1"># conn = wrds.Connection()</span>

<span class="c1"># # get our stock returns</span>

<span class="c1"># df=get_daily_wrds(conn,tickers=[&#39;SPY&#39;,&#39;WMT&#39;,&#39;JPM&#39;])</span>

<span class="c1"># # GET RISK FREE RATE</span>
<span class="c1"># start_date = datetime.datetime(1960, 1, 1)  # Start date (adjust as needed)</span>
<span class="c1"># end_date = datetime.datetime.now()          # End date</span>
<span class="c1"># df_rf = DataReader(&quot;DGS3MO&quot;, &quot;fred&quot;, start_date, end_date)</span>
<span class="c1"># df_rf.reset_index(inplace=True)</span>
<span class="c1"># df_rf.columns = [&quot;Date&quot;, &quot;rf&quot;]</span>
<span class="c1"># df_rf.rf=(df_rf.rf/100)/252  # convert to daily</span>
<span class="c1"># df_rf.set_index(&quot;Date&quot;, inplace=True)</span>

<span class="c1"># # merge with the risk-free rate</span>
<span class="c1"># df=df.merge(df_rf, left_index=True, right_index=True,how=&#39;left&#39;)</span>
<span class="c1"># #</span>
<span class="c1"># df_re=df.drop(columns=&#39;rf&#39;).sub(df[&#39;rf&#39;],axis=0)</span>
<span class="c1"># df_re.to_csv(&#39;../../assets/data/FactorModels_data1.csv&#39;)</span>
<span class="c1">##############################################################################</span>



<span class="n">df_re</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/amoreira2/UG54/refs/heads/main/assets/data/FactorModels_data1.csv&#39;</span><span class="p">)</span>
<span class="n">df_re</span><span class="o">.</span><span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_re</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">df_re</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_re</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-ebb451b8-a8fb-44ad-bc6a-c1b4c03b8c3b" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SPY</th>
      <th>WMT</th>
      <th>JPM</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969-03-05</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1969-03-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1969-03-07</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1969-03-10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1969-03-11</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-12-24</th>
      <td>0.010940</td>
      <td>0.025614</td>
      <td>0.016269</td>
    </tr>
    <tr>
      <th>2024-12-26</th>
      <td>-0.000106</td>
      <td>0.001014</td>
      <td>0.003252</td>
    </tr>
    <tr>
      <th>2024-12-27</th>
      <td>-0.010698</td>
      <td>-0.012349</td>
      <td>-0.008273</td>
    </tr>
    <tr>
      <th>2024-12-30</th>
      <td>-0.011585</td>
      <td>-0.012065</td>
      <td>-0.007844</td>
    </tr>
    <tr>
      <th>2024-12-31</th>
      <td>-0.003811</td>
      <td>-0.002602</td>
      <td>0.001457</td>
    </tr>
  </tbody>
</table>
<p>14079 rows √ó 3 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-ebb451b8-a8fb-44ad-bc6a-c1b4c03b8c3b')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-ebb451b8-a8fb-44ad-bc6a-c1b4c03b8c3b button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-ebb451b8-a8fb-44ad-bc6a-c1b4c03b8c3b');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-419c06a2-3874-4708-99ad-4d4988d9be0e">
      <button class="colab-df-quickchart" onclick="quickchart('df-419c06a2-3874-4708-99ad-4d4988d9be0e')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-419c06a2-3874-4708-99ad-4d4988d9be0e button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

  <div id="id_51e0ebfa-5926-4b81-a366-6651f1a61c4e">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df_re')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_51e0ebfa-5926-4b81-a366-6651f1a61c4e button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df_re');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<blockquote>
<div><p>ü§ù‚è±Ô∏è <strong>Think and Code</strong></p>
<ol class="arabic simple">
<li><p>How do we estimate this model?</p></li>
</ol>
<div class="math notranslate nohighlight">
\[(excess~return)=(intercept)+(stock~beta)*(SPY~excess~return)+ (idio~risk)\]</div>
<ol class="arabic simple" start="2">
<li><p>What should we plot against our factor excess returns to see if it ‚Äúworked‚Äù?</p></li>
<li><p>What do you expect to see?</p></li>
<li><p>What does your estimation says about the relationship between the stock specific component and the factor excess return?</p>
<ul class="simple">
<li><p>Does this condition always hold?</p></li>
</ul>
</li>
<li><p>How do we construct the stock specific component using your estimation?</p></li>
</ol>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">smf</span>
<span class="n">_temp</span><span class="o">=</span> <span class="n">df_re</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span> <span class="s1">&#39;WMT&#39;</span><span class="p">])</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;WMT~SPY&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">_temp</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">intercept_wmt</span><span class="p">,</span> <span class="n">beta_wmt</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;beta of asset WMT is </span><span class="si">{</span><span class="n">beta_wmt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>




<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;WMT&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta_wmt</span><span class="o">*</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SPY vs WMT Residuals&#39;</span><span class="p">)</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;JPM~SPY&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">_temp</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">intercept_jpm</span><span class="p">,</span> <span class="n">beta_jpm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;beta of asset JPM is </span><span class="si">{</span><span class="n">beta_jpm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>




<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;JPM&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta_jpm</span><span class="o">*</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SPY vs JPM Residuals&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Correlation of SPY with residuals of WMT and JPM&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_re</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;JPM&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta_jpm</span><span class="o">*</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_re</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;WMT&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta_jpm</span><span class="o">*</span><span class="n">df_re</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>beta of asset WMT is 0.6737719432407151
beta of asset JPM is 1.3949175281636013
Correlation of SPY with residuals of WMT and JPM
SPY    1.757762e-16
dtype: float64
SPY   -0.517778
dtype: float64
</pre></div>
</div>
<img alt="../../_images/412e2bc6f00566229ccda3e20196bf2ad11f1c681812384c87e7bf75ee964371.png" src="../../_images/412e2bc6f00566229ccda3e20196bf2ad11f1c681812384c87e7bf75ee964371.png" />
</div>
</div>
<blockquote>
<div><p>ü§ù‚è±Ô∏è <strong>Think and Code</strong></p>
<p>How do we estimate the amount of idiosyncratic risk?</p>
<p>How do we estimate the amount of systematic risk?</p>
</div></blockquote>
</section>
<section id="risk-models-vs-expected-returns-models">
<h2>Risk Models vs Expected Returns Models<a class="headerlink" href="#risk-models-vs-expected-returns-models" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>üëâ <strong>Risk</strong> Models</p></li>
</ol>
<ul class="simple">
<li><p>The risk <span class="math notranslate nohighlight">\(\epsilon\)</span> is specific to asset <span class="math notranslate nohighlight">\(i\)</span> and uncorrelated with other assets</p></li>
<li><p>You don‚Äôt really care whether the factors have premia, but only if they explain variation in returns</p></li>
<li><p>It is essentially a model for the covariance matrix of returns</p></li>
<li><p>Extremely used in the industry</p></li>
<li><p><strong>(Q1) What it the key metric for whether a factor model is a good risk model?</strong></p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>üëâ<strong>Expected Return</strong> Models</p></li>
</ol>
<ul class="simple">
<li><p>The premium on the factor f, <span class="math notranslate nohighlight">\(E[f]\)</span> summarize well the known ‚Äúpriced‚Äù systematic risk factors</p></li>
<li><p>By ‚Äúpriced‚Äù we mean risk-factors that earn a risk premium  <span class="math notranslate nohighlight">\(E[f]&gt;0\)</span> of <span class="math notranslate nohighlight">\(E[f]&lt;0\)</span></p></li>
<li><p>Because factors are long shorts we typically normalize so that the premium is positive</p></li>
<li><p>A model can be a good model of expected returns, but not explain much of realized returns</p></li>
<li><p>Such model is useful for performance evaluation</p></li>
<li><p><strong>(Q2)What is the key metric whether a factor model is a good expected return model?</strong></p></li>
</ul>
<p><strong>A blurry distinction</strong></p>
<blockquote>
<div><p>We will call the first a factor model of risk, and the second a factor model of expected returns.</p>
<p>However, this distinction is often blurry.</p>
<p>Arbitrage logic tells us that if we have a really good model of risk, we should also have a good model of expected returns ( Who remembers this from Foundations? It is an a three letter acronym)</p>
<p>But in practice for stocks, there is <strong>lots and lots</strong> of unexplained variation, so you explain a lot of return variation but still don‚Äôt get a firm grip on expected returns</p>
</div></blockquote>
<p>People start with a factor model with ‚Äúpriced‚Äù factors and then add additional factors to explain risk.</p>
<blockquote>
<div><p>what does ‚Äúpriced‚Äù means in this context? What are examples of priced factors and unpriced factors?</p>
</div></blockquote>
<p><strong>More Precisely</strong></p>
<p>Let <span class="math notranslate nohighlight">\(r^e\)</span>         be an asset excess return over the risk-free rate</p>
<p>Let <span class="math notranslate nohighlight">\(f\)</span>    be a traded factor, for now  the <strong>excess returns</strong> on SPY ETF (that holds a basket that replicates the S&amp;P 500 index)</p>
<p>Then we can write</p>
<div class="math notranslate nohighlight">
\[r^e=\alpha + b*f+\epsilon\]</div>
<p>where <span class="math notranslate nohighlight">\(b\)</span> is asset <span class="math notranslate nohighlight">\(i\)</span> exposure to the factor <span class="math notranslate nohighlight">\(f\)</span></p>
<blockquote>
<div><p>We can always write things that way‚Äìit is just a statistical decomposition</p>
</div></blockquote>
<p>Whether we are working with a ‚ÄúRisk Model‚Äù or an ‚ÄúExpected Return‚Äù model will come down to the following</p>
<ol class="arabic simple">
<li><p>For risk model we assume <span class="math notranslate nohighlight">\(\epsilon\)</span> uncorrelated across stocks
üëâ To explain risk , factors must capture all co-movement in REALIZED returns</p>
<ul class="simple">
<li><p>(Q1) What does that mean in the context of the equation above?</p></li>
</ul>
</li>
<li><p>For Expected return model, we assume <span class="math notranslate nohighlight">\(\alpha=0\)</span> for all stocks/strategies
üëâ to explain risk premia, model needs to explain all variation in EXPECTED returns.</p>
<ul class="simple">
<li><p>(Q2) What does that mean in the context of the equation above?</p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="the-organization-of-wall-street-alpha-and-beta-s">
<h2>The organization of Wall Street: Alpha and Beta(s)<a class="headerlink" href="#the-organization-of-wall-street-alpha-and-beta-s" title="Link to this heading">#</a></h2>
<ul>
<li><p>the alpha/Beta decomposition is how the money management industry is organized.</p>
<ul>
<li><p>Big bonuses only if people think you have <strong>alpha</strong></p></li>
<li><p>Getting exposure to the factor is a commodity. Anyone can buy SPY or many other indexes that track the market very well</p></li>
<li><p>In many funds a portfolio manager mandate is to take no factor risk‚Äìor at least aim to be close to factor neutral.</p>
<p>üëâ  specially true for portfolio managers working a pod shops</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.wsj.com/finance/investing/citadel-ken-griffin-hedge-funds-c9ddf51d">Citadel</a></p></li>
<li><p><a class="reference external" href="https://www.wsj.com/finance/investing-the-giant-hedge-fund-that-hates-risk-and-still-wins-1110e90a">Millenium</a></p></li>
<li><p><a class="reference external" href="https://www.bamfunds.com/">Balyasny</a></p></li>
</ul>
</li>
<li><p>In mutual funds it is still about the alpha‚Äìbut the factor models are simpler (1 to 3 factors), so lots of factor exposure ends up counted as alpha when these factors have premia</p></li>
</ul>
</li>
<li><p>factor models allow you to understand and hedge risk</p>
<ul class="simple">
<li><p>This is essential if you want to concentrate your portfolio only on risks that you get compensated for holding</p></li>
</ul>
</li>
</ul>
</section>
<section id="from-factor-exposure-to-risk-premia">
<h2>From Factor Exposure to Risk Premia<a class="headerlink" href="#from-factor-exposure-to-risk-premia" title="Link to this heading">#</a></h2>
<p>Note that</p>
<div class="math notranslate nohighlight">
\[E[r]=E[rf+r^{e}]=rf+E[\alpha_i + b*f+\epsilon]\]</div>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha+b*E[f]+E[\epsilon]\]</div>
<ul class="simple">
<li><p>Using that <span class="math notranslate nohighlight">\(E[\epsilon]=0\)</span> we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[r]=rf+\alpha+b*E[f]\]</div>
<ul class="simple">
<li><p>Thus, just like the risk of our asset could be attributed to the factor and it‚Äôs component, the same model also allow us to decompose the expected return in terms of the risk-free rate, the premium coming from the common factor exposure <span class="math notranslate nohighlight">\(b*E[f]\)</span> and the risk-premium specific to the asset, the ALPHA.</p></li>
<li><p>The alpha does not need to be in a specific asset, can be in a combination of them</p></li>
<li><p>The decomposition works the same for portfolio of assets</p></li>
<li><p>For now we have a single factor, but you will see that as you have more factors, everything is exactly the same</p></li>
<li><p><strong>‚Åâ If you have a good model of expected returns , what is the premia on your asset?</strong></p></li>
</ul>
</section>
<section id="focus-on-your-skill-hedge-all-the-residual-risk">
<h2>Focus on your skill, hedge all the residual risk<a class="headerlink" href="#focus-on-your-skill-hedge-all-the-residual-risk" title="Link to this heading">#</a></h2>
<p>If you have an asset that has alpha, says, you are confident that Microsoft will beat expectations and you expect a 5% appreciation in the next 12 months beyond any factor exposure that Microsoft might had</p>
<p><strong>(Q3)  What should you do?</strong></p>
<p>Describe how would you implement this trade</p>
<p><strong>Implementing</strong></p>
<ul class="simple">
<li><p>Lets do this! I will use a regression to get some numbers for us to do this strategy</p></li>
<li><p><strong>For now</strong>, just think those as numbers as the truth</p></li>
<li><p><strong>You should not think of the regression as giving the right numbers necessarily.</strong> The regression gives use the best point estimate <strong>in sample</strong></p></li>
<li><p>What do we actuall want?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># LOADING THE DATA</span>

<span class="c1">########################################################</span>
<span class="c1"># that is the code to get data from WRDS</span>
<span class="c1"># you need to have an account with WRDS and the wrds package installed</span>
<span class="c1"># uncomment the code below to get data from WRDS</span>

<span class="c1"># conn = wrds.Connection()</span>
<span class="c1"># ticker=[&#39;MSFT&#39;]</span>
<span class="c1"># df_returns = get_daily_wrds(conn,tickers=ticker)</span>
<span class="c1"># print(df_returns.head())</span>
<span class="c1"># df_returns.describe()</span>
<span class="c1"># I used this to save the data to a csv file and then load it from there</span>
<span class="c1">#df_returns.to_csv(&#39;../../assets/data/FactorModels_data2.csv&#39;)</span>

<span class="n">df_returns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/amoreira2/UG54/refs/heads/main/assets/data/FactorModels_data2.csv&#39;</span><span class="p">)</span>
<span class="n">df_returns</span><span class="o">.</span><span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_returns</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
<span class="n">df_returns</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_returns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-7094d3fd-2b62-441a-87ee-ab337bbf57bb" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSFT</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1986-03-13</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1986-03-14</th>
      <td>0.035714</td>
    </tr>
    <tr>
      <th>1986-03-17</th>
      <td>0.017241</td>
    </tr>
    <tr>
      <th>1986-03-18</th>
      <td>-0.025424</td>
    </tr>
    <tr>
      <th>1986-03-19</th>
      <td>-0.017391</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-12-24</th>
      <td>0.009374</td>
    </tr>
    <tr>
      <th>2024-12-26</th>
      <td>-0.002777</td>
    </tr>
    <tr>
      <th>2024-12-27</th>
      <td>-0.017302</td>
    </tr>
    <tr>
      <th>2024-12-30</th>
      <td>-0.013240</td>
    </tr>
    <tr>
      <th>2024-12-31</th>
      <td>-0.007838</td>
    </tr>
  </tbody>
</table>
<p>9779 rows √ó 1 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-7094d3fd-2b62-441a-87ee-ab337bbf57bb')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-7094d3fd-2b62-441a-87ee-ab337bbf57bb button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-7094d3fd-2b62-441a-87ee-ab337bbf57bb');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-b9c3fa4c-37cb-42cd-b9b7-476dbe367354">
      <button class="colab-df-quickchart" onclick="quickchart('df-b9c3fa4c-37cb-42cd-b9b7-476dbe367354')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-b9c3fa4c-37cb-42cd-b9b7-476dbe367354 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

  <div id="id_aa75fc8f-1ad8-497a-bd64-4d21ee37e858">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df_returns')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_aa75fc8f-1ad8-497a-bd64-4d21ee37e858 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df_returns');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this gets daily data on multiple factors plust the risk-free rate</span>
<span class="c1"># you can think of these factors as returns on funds that hold certain assets</span>
<span class="c1"># but the portfolios are constructed using a predefined rule</span>
<span class="c1"># for now we will use only the market factor and the risk-free rate</span>

<span class="n">df_factor</span> <span class="o">=</span> <span class="n">get_factors</span><span class="p">()</span>
<span class="c1"># instead of merge them in the same dataframe. I will simply align then on the index</span>
<span class="c1"># I sometimes find more convenient to have them in separate dataframes</span>
<span class="c1"># but aligned on the same dates</span>
<span class="n">df_returns</span><span class="p">,</span> <span class="n">df_factor</span> <span class="o">=</span> <span class="n">df_returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df_factor</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">df_factor</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_returns</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipython-input-928730754.py:38: FutureWarning: The argument &#39;date_parser&#39; is deprecated and will be removed in a future version. Please use &#39;date_format&#39; instead, or read your data in as &#39;object&#39; dtype and then call &#39;to_datetime&#39;.
  fama_french = DataReader(&quot;F-F_Research_Data_5_Factors_2x3_daily&quot;, &quot;famafrench&quot;,start=&quot;1926-01-01&quot;)
</pre></div>
</div>
<div class="output text_html">
  <div id="df-372f9416-997c-4789-9e67-82a20c2610de" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RF</th>
      <th>Mkt-RF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1986-03-14</th>
      <td>0.0003</td>
      <td>0.0103</td>
    </tr>
    <tr>
      <th>1986-03-17</th>
      <td>0.0003</td>
      <td>-0.0076</td>
    </tr>
    <tr>
      <th>1986-03-18</th>
      <td>0.0003</td>
      <td>0.0047</td>
    </tr>
    <tr>
      <th>1986-03-19</th>
      <td>0.0003</td>
      <td>-0.0017</td>
    </tr>
    <tr>
      <th>1986-03-20</th>
      <td>0.0003</td>
      <td>0.0039</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-372f9416-997c-4789-9e67-82a20c2610de')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-372f9416-997c-4789-9e67-82a20c2610de button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-372f9416-997c-4789-9e67-82a20c2610de');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-156e056f-f423-4ae1-afa2-99f2bf750d1a">
      <button class="colab-df-quickchart" onclick="quickchart('df-156e056f-f423-4ae1-afa2-99f2bf750d1a')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-156e056f-f423-4ae1-afa2-99f2bf750d1a button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div><div class="output text_html">
  <div id="df-e88e3b5f-ad4d-4737-8837-0e638b0f3a93" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSFT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1986-03-14</th>
      <td>0.035714</td>
    </tr>
    <tr>
      <th>1986-03-17</th>
      <td>0.017241</td>
    </tr>
    <tr>
      <th>1986-03-18</th>
      <td>-0.025424</td>
    </tr>
    <tr>
      <th>1986-03-19</th>
      <td>-0.017391</td>
    </tr>
    <tr>
      <th>1986-03-20</th>
      <td>-0.026549</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-e88e3b5f-ad4d-4737-8837-0e638b0f3a93')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-e88e3b5f-ad4d-4737-8837-0e638b0f3a93 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-e88e3b5f-ad4d-4737-8837-0e638b0f3a93');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


    <div id="df-d820e8ac-4da5-4a2a-928b-dcb624c83dc0">
      <button class="colab-df-quickchart" onclick="quickchart('df-d820e8ac-4da5-4a2a-928b-dcb624c83dc0')"
                title="Suggest charts"
                style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
      </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

      <script>
        async function quickchart(key) {
          const quickchartButtonEl =
            document.querySelector('#' + key + ' button');
          quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
          quickchartButtonEl.classList.add('colab-df-spinner');
          try {
            const charts = await google.colab.kernel.invokeFunction(
                'suggestCharts', [key], {});
          } catch (error) {
            console.error('Error during call to suggestCharts:', error);
          }
          quickchartButtonEl.classList.remove('colab-df-spinner');
          quickchartButtonEl.classList.add('colab-df-quickchart-complete');
        }
        (() => {
          let quickchartButtonEl =
            document.querySelector('#df-d820e8ac-4da5-4a2a-928b-dcb624c83dc0 button');
          quickchartButtonEl.style.display =
            google.colab.kernel.accessAllowed ? 'block' : 'none';
        })();
      </script>
    </div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RUNNING THE REGRESSION</span>
<span class="c1">##########################################################</span>
<span class="n">df_eret</span><span class="o">=</span><span class="n">df_returns</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">]</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_eret</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.415
Model:                            OLS   Adj. R-squared:                  0.415
Method:                 Least Squares   F-statistic:                     6940.
Date:                Thu, 11 Sep 2025   Prob (F-statistic):               0.00
Time:                        14:27:08   Log-Likelihood:                 26516.
No. Observations:                9778   AIC:                        -5.303e+04
Df Residuals:                    9776   BIC:                        -5.301e+04
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0006      0.000      3.581      0.000       0.000       0.001
Mkt-RF         1.1873      0.014     83.309      0.000       1.159       1.215
==============================================================================
Omnibus:                     1453.222   Durbin-Watson:                   1.929
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            22222.564
Skew:                           0.141   Prob(JB):                         0.00
Kurtosis:                      10.380   Cond. No.                         87.7
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>ü§ù‚è±Ô∏è<strong>Stop and Think</strong></p>
<ul class="simple">
<li><p>Assuming this alpha is true. Is it large? Could you make a living out of this?</p></li>
</ul>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># REGRESSION RESULTS</span>

<span class="c1">###########################################</span>
<span class="n">alpha</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span>
<span class="n">beta</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">var_r</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">var_f</span><span class="o">=</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">var_e</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">mu_f</span><span class="o">=</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Alpha: </span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Beta: </span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of MSFT returns (var_r): </span><span class="si">{</span><span class="n">var_r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of market factor (var_f): </span><span class="si">{</span><span class="n">var_f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variance of residuals (var_e): </span><span class="si">{</span><span class="n">var_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean of market factor (mu_f): </span><span class="si">{</span><span class="n">mu_f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># NOTE: An alternative way to get vizualize the results is simply use the summary mothod on the estiamted &quot;model&quot;</span>
<span class="c1"># this is not what we want here becasue we want to store the different coefficients in different variables to use them in out trading strategy</span>

<span class="c1">#model.summary()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Alpha: 0.0005823266697619099
Beta: 1.1873101041534255
Variance of MSFT returns (var_r): 0.00044165728317184484
Variance of market factor (var_f): 0.0001300756726848574
Variance of residuals (var_e): 0.0002582889201429655
Mean of market factor (mu_f): 0.0003594497852321538
</pre></div>
</div>
</div>
</div>
</section>
<section id="tacking-hedging-and-hedged-portfolios">
<h2>Tacking, Hedging and Hedged portfolios<a class="headerlink" href="#tacking-hedging-and-hedged-portfolios" title="Link to this heading">#</a></h2>
<p><strong>Tracking Portfolios</strong></p>
<p>We also refer to it as ‚Äúhedging portfolios‚Äù or ‚Äúmimicking portfolios‚Äù</p>
<p>Tracking portfolios are the portfolios that use a set of factors to track the returns on an asset.</p>
<ul>
<li><p>It can be used as a way to construct hedges for corporations, hedges for trading strategies, or a way to define a benchmark for an active manager</p></li>
<li><p>It is used to construct what people in the industry calls ‚Äúportable alpha‚Äù, because it allows one to separate the alpha of a trading strategy‚Äôs factor exposure</p></li>
<li><p>The idea of the tracking portfolio is to track the component of an asset return that can be obtained by investing in a simple traded factor (or combos of traded factors). For now, this means the market portfolio.</p></li>
<li><p>For a given factor model representation of a trading strategy</p>
<div class="math notranslate nohighlight">
\[r^e_i=\alpha_i+\beta_if+\epsilon_i, \]</div>
<p>with <span class="math notranslate nohighlight">\(var(\epsilon_i)=\sigma_e^2\)</span></p>
</li>
<li><p>the asset <span class="math notranslate nohighlight">\(i\)</span> Tracking portfolio is <span class="math notranslate nohighlight">\(\beta_i\times W^{MKT}\)</span>, where <span class="math notranslate nohighlight">\(W^{MKT}\)</span> is the vector of weights of the market portfolio.</p></li>
<li><p>or if one is trading directly on the total market portfolio as an asset, the tracking portfolio weight on the market portfolio asset is simply <span class="math notranslate nohighlight">\(\beta_i\)</span> on the ETF that holds the market portfolio</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>In our case above we say the tracking portfolio of the stock is <span class="math notranslate nohighlight">\(\beta\)</span> and the hedging portfolio -<span class="math notranslate nohighlight">\(\beta\)</span> on the market</p></li>
</ul>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns on the the market and the asset</span>

<span class="n">Portfolio</span><span class="o">=</span><span class="n">df_eret</span>
<span class="n">MKT</span><span class="o">=</span><span class="n">df_factor</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
<span class="n">Tracking</span><span class="o">=</span><span class="n">MKT</span><span class="o">*</span><span class="n">beta</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Portfolio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7b20b0362390&gt;
</pre></div>
</div>
<img alt="../../_images/41634260937a291ee6af57c5112143ca292b702984aaad1f8ba0b5201447a66b.png" src="../../_images/41634260937a291ee6af57c5112143ca292b702984aaad1f8ba0b5201447a66b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adding the tracking portfolio</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Portfolio</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Tracking</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Portfolio&#39;</span><span class="p">,</span><span class="s1">&#39;Tracking&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/529c85e27d1c0976bbbf7df032c759324d693aae39f953ee1ebd71b5fca915d1.png" src="../../_images/529c85e27d1c0976bbbf7df032c759324d693aae39f953ee1ebd71b5fca915d1.png" />
</div>
</div>
<ul class="simple">
<li><p>We see  the obvious fact that we cannot track at all variation in the stock with the market portfolio</p></li>
<li><p>they have some co-movement but also capture  different risks</p></li>
<li><p>The tracking is a perfect straight line where the slope is the beta of the asset</p></li>
</ul>
<p><strong>Hedged portfolio</strong></p>
<p>The Hedged strategy return (also called portable alpha) is</p>
<div class="math notranslate nohighlight">
\[r^{hedged}_i=r^e_i-\beta_ir^{MKT}\]</div>
<ul class="simple">
<li><p>This portfolio can be constructed simply by <span class="math notranslate nohighlight">\(W^i-\beta^iW^{MKT}\)</span>, the weights of the trading strategy minus the tracking portfolio weights.</p></li>
<li><p>The excess returns take out risk-free rate effects</p></li>
<li><p>the hedged portfolio takes out market factor effects</p></li>
</ul>
<p>üëâ <strong>Insight</strong></p>
<ul class="simple">
<li><p>The mean return of the hedged portfolio is just the time series alpha of the unhedged portfolio</p>
<ul>
<li><p>Intuition: The hedged portfolio has mechanically zero beta (in-sample) so it‚Äôs excess return is ‚Äúpure‚Äù alpha</p></li>
</ul>
</li>
<li><p>The volatility of the strategy is the vol of the residuals of the time series regression</p></li>
<li><p>If you run a regression on the market you will see that the hedged portfolios have <span class="math notranslate nohighlight">\(\beta=0\)</span>, which is by construction.</p></li>
<li><p>This is the reason why sometimes people call these portfolios ‚ÄúPure Alpha‚Äù, or as Bridgewater calls it, ‚ÄúPortable Alpha‚Äù</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns on the hedged portfolio</span>
<span class="n">Hedged</span><span class="o">=</span><span class="n">Portfolio</span><span class="o">-</span><span class="n">Tracking</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">MKT</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">MKT</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">Hedged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/67e788b9ceea8d13a499121db741922443f120e9409856331aea995000f6f3b0.png" src="../../_images/67e788b9ceea8d13a499121db741922443f120e9409856331aea995000f6f3b0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verificaiton that they indeed the hedged portfolio harvest the alpha</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hedge portfolio excess returns&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Hedged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;alpha of unhedge portfolio&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>hedge portfolio excess returns
0.006987920037142919
alpha of unhedge portfolio
0.006987920037142919
</pre></div>
</div>
</div>
</div>
</section>
<section id="factor-models-and-risk-budgets">
<h2>Factor Models and Risk Budgets<a class="headerlink" href="#factor-models-and-risk-budgets" title="Link to this heading">#</a></h2>
<section id="try-it-out">
<h3>üîß Try it out<a class="headerlink" href="#try-it-out" title="Link to this heading">#</a></h3>
<p>Lets say we have 1 million dollar per month volatility (i.e. standard deviation) budget</p>
<p>What that means? How much can I buy of MSFT?</p>
<p>What if the budget was for 1 year? How do I adjust my calculation?</p>
<p>Can I buy more or less?</p>
</section>
<section id="what-is-your-expected-pnl-in-the-end-of-the-year">
<h3>What is your <strong>expected</strong> PnL in the end of the year?<a class="headerlink" href="#what-is-your-expected-pnl-in-the-end-of-the-year" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Here we will subtract your funding costs, which I will assume is also rf so it will be a wash</p></li>
<li><p><span class="math notranslate nohighlight">\(rf+\beta*\mu_f+\alpha\)</span> is your expected return</p></li>
<li><p><span class="math notranslate nohighlight">\(rf\)</span> is your funding cost</p></li>
</ul>
<p>Net of direct funding costs
$<span class="math notranslate nohighlight">\(x*(rf+\beta*\mu_f+\alpha-rf)*252\)</span>$</p>
<ul class="simple">
<li><p>Often shops have risk-adjusted PnL. So while you might expect to make <code class="docutils literal notranslate"><span class="pre">x*(beta*mu_f+alpha)*252</span></code> for the fund, they only comp you based on <code class="docutils literal notranslate"><span class="pre">x*(alpha)*252</span></code></p></li>
</ul>
<p>Net of direct funding costs  and factor exposures
$<span class="math notranslate nohighlight">\(x*(rf+\beta*\mu_f+\alpha-rf-\beta*\mu_f)*252\)</span>$</p>
<ul class="simple">
<li><p>What is your risk-adjusted Expected PnL after your market exposure is subtracted</p></li>
</ul>
<div class="math notranslate nohighlight">
\[x*(\alpha)*252\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">beta</span><span class="o">*</span><span class="n">mu_f</span><span class="o">+</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="focusing-on-your-edge">
<h3>Focusing on your edge<a class="headerlink" href="#focusing-on-your-edge" title="Link to this heading">#</a></h3>
<p>(Q4) Now suppose you focus your edge‚Äìi.e. investing in MSFT but hedging the market risk</p>
<ol class="arabic simple">
<li><p>How much of the market do I need to short per dollar invested in MSFT?</p></li>
<li><p>What your portfolio looks like?</p></li>
<li><p>How many dollars in MSFT can I buy? (lets say for a yearly budget)</p></li>
</ol>
</section>
<section id="the-benefits-of-focusing-your-bets">
<h3>The benefits of focusing your bets<a class="headerlink" href="#the-benefits-of-focusing-your-bets" title="Link to this heading">#</a></h3>
<p>Note that the hedged portfolio return is</p>
<div class="math notranslate nohighlight">
\[rh=re-\beta*f=\alpha+\epsilon\]</div>
<p>Note that <span class="math notranslate nohighlight">\(E[f\epsilon]=0\)</span> as beta is such that there is no factor risk left in the residuals ( that is the OLS regression assumption!)</p>
<p>The leftover risk is exactly orthogonal to the factor risk</p>
<p>This what makes this the optimal hedge portfolio‚Äì&gt; it hedges all the market risk!</p>
<p>So it follows that</p>
<div class="math notranslate nohighlight">
\[Var(rh)=Var(\alpha+\epsilon)=Var(\epsilon)\]</div>
<ul class="simple">
<li><p>What is you expected  PnL?</p></li>
<li><p>What is you expected ‚Äúfactor-adjusted PnL‚Äù?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xe</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="sharpe-ratio">
<h2>Sharpe Ratio<a class="headerlink" href="#sharpe-ratio" title="Link to this heading">#</a></h2>
<p>Sharpe ratio is one of the most important metrics in the industry</p>
<p>It measures how much extra return you are expected to earn per unit of risk</p>
<div class="math notranslate nohighlight">
\[\frac{E[r]-rf}{\sigma(r)}\]</div>
<p>What is you portfolio Sharpe with the hedge and without the hedge?</p>
<p>Do you always come ahead by hedging it out?</p>
</section>
<section id="appraisal-ratio">
<h2>Appraisal Ratio<a class="headerlink" href="#appraisal-ratio" title="Link to this heading">#</a></h2>
<p>Appraisal ratio is the the most important metrics in the industry</p>
<p>It measures how much extra return you are expected to earn per unit of risk after your strip out all factor premia</p>
<div class="math notranslate nohighlight">
\[\frac{E[r-bf-rf]}{\sigma(r-bf)}=\frac{\alpha}{\sigma(\epsilon)}\]</div>
<p>Often people with just call this the  Sharpe Ratio of the factor neutral portfolio, i.e. the Sharpe ratio of hedged portfolio</p>
<p>Do you always come ahead by hedging it out?</p>
</section>
<section id="variance-decomposition">
<h2>Variance Decomposition<a class="headerlink" href="#variance-decomposition" title="Link to this heading">#</a></h2>
<p>Factor models are essential to manage risk</p>
<p>A pod shop manager , a manager in a mutual fund in a large mutual fund company, a hedge fund trader in a large hedge fund,‚Ä¶all of those will typically have tight limits on the TOTAL risk of their portfolio, i.e. <span class="math notranslate nohighlight">\(var(r)\)</span> but also on the factor component of their portfolio</p>
<p>But even if you don‚Äôt, and you are an active manager with freedom of trading, you still want to control quite carefully which  risks you are taking in your portfolio</p>
<p>The decomposition here with single factor is really easy, but once you understand it, the multi-factor decomposition will be also easy to understand ( even it a little more involved)</p>
<ol class="arabic simple">
<li><p>The total variance of your strategy/asset is</p></li>
</ol>
<div class="math notranslate nohighlight">
\[Var(r^e)=Var(\alpha +b*f+\epsilon)=Var(b*f)+Var(\epsilon)=b^2Var(f)+var(\epsilon)\]</div>
<p>We can see already the factor part <span class="math notranslate nohighlight">\((b^2Var(f))\)</span> and the idiosyncratic part <span class="math notranslate nohighlight">\(var(\epsilon)\)</span>. It decomposes nicely because e and f are orthogonal.</p>
<ol class="arabic simple" start="2">
<li><p>The fraction of factor risk in your portfolio is</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\frac{b^2Var(f)}{Var(r^e)}\]</div>
<p>You factor risk depends</p>
<ul class="simple">
<li><p>on your factor beta‚Äìthis might grow in a market turmoil for example</p></li>
<li><p>on the factor variance‚Äìalso might grow when markets are choppy</p></li>
</ul>
<p>The factor risk-share also depend on the idio vol. During a market turmoil all vols tend to go up, but factor vols tend to go up more</p>
<p>So both your total risk grows as the share of factor risk</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">var_f</span><span class="o">/</span><span class="n">var_r</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4141025460425463
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="key-takeaways">
<h2>üìù Key Takeaways<a class="headerlink" href="#key-takeaways" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Factor models separate what you <em>earn</em> from what you <em>ride</em>.</strong><br />
Beta captures common market movements; alpha is the slice of return not explained by those movements.</p></li>
<li><p><strong>Hedging out Œ≤ turns views into ‚Äúportable‚Äù alpha.</strong><br />
Going long the asset and short Œ≤ units of the factor neutralizes systematic risk, leaving a position whose mean excess return equals its alpha and whose volatility equals the residual variance.</p></li>
<li><p><strong>Risk budgets shrink once you hedge intelligently.</strong><br />
A hedged position‚Äôs lower volatility allows you to deploy more capital for the same risk cap‚Äîand to earn more alpha-attributed P&amp;L.</p></li>
<li><p><strong>Variance decomposition is your monitoring dashboard.</strong><br />
It tells you how much of today‚Äôs risk is coming from factors versus idiosyncratic shocks and highlights when market turmoil swells the factor share.</p></li>
<li><p><strong>Tracking portfolios clarify performance attribution.</strong><br />
By explicitly matching the factor component, you can assess whether a manager‚Äôs outperformance is genuine skill or just hidden beta.</p></li>
<li><p><strong>Factor-implied covariance matrices are parsimonious and , maybe, more intuitive.</strong><br />
Estimating only N betas, N idiosyncratic variances, and one factor variance yields a workable covariance estimate even when the full N √ó N matrix is unmanageable.</p></li>
<li><p><strong>All numbers are frequency-specific.</strong><br />
Alpha, variances, co-variances and Sharpe ratios must be annualized (or otherwise scaled) consistently before comparison or budgeting.  Beta is the only one that is theoretically invariant</p></li>
</ul>
<hr class="docutils" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libraries-and-auxiliary-functions">Libraries and Auxiliary Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#towards-a-factor-model">Towards a Factor Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-models-vs-expected-returns-models">Risk Models vs Expected Returns Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-organization-of-wall-street-alpha-and-beta-s">The organization of Wall Street: Alpha and Beta(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-factor-exposure-to-risk-premia">From Factor Exposure to Risk Premia</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#focus-on-your-skill-hedge-all-the-residual-risk">Focus on your skill, hedge all the residual risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tacking-hedging-and-hedged-portfolios">Tacking, Hedging and Hedged portfolios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-and-risk-budgets">Factor Models and Risk Budgets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#try-it-out">üîß Try it out</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-your-expected-pnl-in-the-end-of-the-year">What is your <strong>expected</strong> PnL in the end of the year?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#focusing-on-your-edge">Focusing on your edge</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-benefits-of-focusing-your-bets">The benefits of focusing your bets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharpe-ratio">Sharpe Ratio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appraisal-ratio">Appraisal Ratio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variance-decomposition">Variance Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">üìù Key Takeaways</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>